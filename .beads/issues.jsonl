{"id":"VAULT-004","title":"[CQ-10] Remove emoji from production logs, replace print() with Logger","description":"VaultViewModel.swift has inconsistent logging:\n\n1. Emoji in production logs (lines ~443-465):\n   logger.info('üì∏ Starting import of ...')\n   logger.error('‚ùå Import failed: ...')\n   logger.info('üí∞ User is premium, skipping paywall')\n   logger.info('‚úÖ Import completed successfully')\n   FIX: Remove emoji prefixes. Use plain descriptive text.\n\n2. print() instead of Logger (lines ~827-836):\n   #if DEBUG\n   print('Error loading vault files: ...')\n   #endif\n   FIX: Replace with logger.debug('Error loading vault files: ...')\n\nFile: apps/ios/Vault/Features/VaultViewer/VaultViewModel.swift\nTEST: Build should succeed. grep for emoji in .swift log statements should return nothing.","status":"open","priority":4,"issue_type":"task","owner":"r@turek.co","created_at":"2026-02-23T13:25:09.223306-08:00","created_by":"ehmo","updated_at":"2026-02-23T13:25:09.223306-08:00"}
{"id":"VAULT-024","title":"Security: Add SecureBytes wrapper with deinit zeroise() for key material","description":"Vault key, master key, and share key are held as Data (value type, no zeroing guarantee) for the entire unlocked session. Fix: introduce SecureBytes class wrapper with explicit deinit { zeroise() }. Apply to VaultKey, MasterKey, ShareKey (see A4 newtype issue). Pairs with the VaultKey/MasterKey/ShareKey newtype work.","status":"closed","priority":1,"issue_type":"feature","owner":"r@turek.co","created_at":"2026-02-17T20:36:41.99098-08:00","created_by":"ehmo","updated_at":"2026-02-17T22:08:30.269765-08:00","closed_at":"2026-02-17T22:08:30.269765-08:00","close_reason":"Implemented and tested in commit 07af505"}
{"id":"VAULT-03m","title":"Add SecureEnclaveManager tests with Keychain abstraction","description":"TEST #23: SecureEnclaveManager manages Keychain for device salt, wipe counter, duress fingerprint, blob cursor key. Zero test coverage.\n\nIMPLEMENTATION:\n1. Define KeychainClient protocol:\n   ```swift\n   protocol KeychainClient {\n       func save(data: Data, service: String, account: String, accessibility: String) throws\n       func load(service: String, account: String) throws -\u003e Data?\n       func delete(service: String, account: String) throws\n   }\n   ```\n2. Make SecureEnclaveManager accept a KeychainClient (default: real Keychain)\n3. Create MockKeychainClient for tests\n4. Create SecureEnclaveManagerTests.swift:\n   - Test: salt generation creates 32 random bytes\n   - Test: salt retrieval returns previously generated salt\n   - Test: wipe counter increment/reset\n   - Test: duress fingerprint set/get/clear\n   - Test: blob cursor key generation\n   - Test: nuclear wipe deletes all items\n   - Test: Keychain unavailable scenarios (locked device, etc.)\n\nKEY FILES:\n- apps/ios/Vault/Core/Security/SecureEnclaveManager.swift","status":"closed","priority":1,"issue_type":"task","owner":"r@turek.co","created_at":"2026-02-21T11:37:32.440701-08:00","created_by":"ehmo","updated_at":"2026-02-21T12:21:43.890618-08:00","closed_at":"2026-02-21T12:21:43.890618-08:00","close_reason":"20 tests: wipe counter, duress fingerprint, blob cursor key, device salt, nuclear wipe, SE availability."}
{"id":"VAULT-0ei","title":"Preserve VaultView state when returning from settings","description":"VaultView.swift:220-225 clears all files and shows spinner when settings sheet dismissed. Resets scroll position and search state. Should only reload if data actually changed.","status":"closed","priority":2,"issue_type":"bug","owner":"r@turek.co","created_at":"2026-02-01T15:10:24.14638-08:00","created_by":"ehmo","updated_at":"2026-02-01T15:21:16.005821-08:00","closed_at":"2026-02-01T15:21:16.005821-08:00","close_reason":"Removed destructive files=[] and isLoading=true when settings sheet dismisses. Now calls loadFiles() and checkSharedVaultStatus() without clearing state, preserving scroll position and search text."}
{"id":"VAULT-0vb","title":"[CQ-2] Simplify checkPhraseAvailability: remove dual-path, add logging","description":"CloudKitSharingManager.checkPhraseAvailability (lines ~119-164) uses belt-and-suspenders pattern: direct record fetch then query fallback. First catch block is empty (no logging). Redundant since both paths use same record ID.\n\nPLAN:\n1. Remove the query-based fallback path (lines ~140-163)\n2. Keep only the direct record fetch (lines ~124-138)\n3. Add logging to the catch block for CKError cases\n4. Ensure .networkError is returned for non-.unknownItem errors (not silent fallthrough)\n5. Map CKError.unknownItem -\u003e .vaultNotFound\n\nFile: CloudKitSharingManager.swift:119-164\nTEST: Verify phrase availability check works for: valid phrase, claimed phrase, revoked phrase, network error, missing record.","status":"open","priority":2,"issue_type":"task","owner":"r@turek.co","created_at":"2026-02-23T13:24:16.247912-08:00","created_by":"ehmo","updated_at":"2026-02-23T13:24:16.247912-08:00"}
{"id":"VAULT-0w6","title":"[Arch-2] Add protocol-based DI for CryptoEngine, SecureEnclaveManager, DuressHandler","description":"24 singletons accessed via hard .shared coupling. VaultStorageProtocol exists as a pattern to follow.\n\nPLAN:\n1. Create CryptoEngineProtocol mirroring CryptoEngine's public static methods as instance methods\n2. Create SecureEnclaveProtocol for SecureEnclaveManager's public API\n3. Create DuressHandlerProtocol for DuressHandler's public API\n4. Add protocol conformance to existing singletons\n5. Update high-test-priority types to accept protocols via init (VaultIndexManager, AppState, ShareSyncManager)\n6. Keep .shared as default parameter values\n7. Create mock implementations in test target\n\nFiles with .shared access: VaultApp.swift (15+ references), ContentView.swift, DuressHandler.swift, VaultStorage.swift\nPattern to follow: VaultStorageProtocol.swift","status":"open","priority":2,"issue_type":"task","owner":"r@turek.co","created_at":"2026-02-23T12:02:51.987389-08:00","created_by":"ehmo","updated_at":"2026-02-23T12:02:51.987389-08:00"}
{"id":"VAULT-10k","title":"Add billing/subscription tests (mock + StoreKit)","description":"TEST #21: SubscriptionManager and SubscriptionClient have ZERO test coverage. Controls premium feature gating, purchase flow, free tier limits. Bug here = paying users locked out OR free users get premium.\n\nIMPLEMENTATION:\n1. Create MockSubscriptionClient conforming to SubscriptionClient protocol\n2. Create SubscriptionManagerTests.swift:\n   - Test free tier limits (100 files, 5 vaults) with mock returning non-premium\n   - Test premium unlocks all features with mock returning premium\n   - Test entitlement caching behavior\n   - Test purchase state transitions (none -\u003e purchasing -\u003e purchased)\n   - Test restore flow\n   - Test edge: expired subscription reverts to free tier\n   - Test edge: subscription upgrade (monthly -\u003e annual)\n3. Create StoreKitIntegrationTests.swift using Vaultaire Pro.storekit config file:\n   - Test product loading\n   - Test purchase simulation\n   - Test receipt verification\n\nKEY FILES:\n- apps/ios/Vault/Core/Billing/SubscriptionManager.swift (logic to test)\n- apps/ios/Vault/Core/Billing/SubscriptionClient.swift (protocol to mock)\n- apps/ios/Vaultaire Pro.storekit (StoreKit config file already exists)","status":"closed","priority":1,"issue_type":"task","owner":"r@turek.co","created_at":"2026-02-21T11:37:22.33957-08:00","created_by":"ehmo","updated_at":"2026-02-21T12:17:12.706829-08:00","closed_at":"2026-02-21T12:17:12.706829-08:00","close_reason":"23 tests: MockSubscriptionClient, free tier limits, premium unlocks, state transitions, boundary conditions, brute-force delay."}
{"id":"VAULT-151","title":"Refactor: DRY ‚Äî extract writeToBlobPool() from 3 duplicated store methods","description":"VaultStorage.swift:667-760, 788-861, 889-967: The ~40-line block (find blob with space, expand if needed, open FileHandle, write, update cursor, update index) is copy-pasted across storeFile(), storeFiles(), storeFileFromURL(). Copies already diverge in Embrace span reporting. Extract private writeToBlobPool(data:index:) -\u003e BlobWriteResult helper.","status":"closed","priority":2,"issue_type":"task","owner":"r@turek.co","created_at":"2026-02-17T20:37:40.173615-08:00","created_by":"ehmo","updated_at":"2026-02-17T21:21:32.099907-08:00","closed_at":"2026-02-17T21:21:32.099907-08:00","close_reason":"Closed"}
{"id":"VAULT-1gr","title":"Bug: deleteFileById silently swallows errors with try?","description":"VaultView+Actions.swift:99 (also batchDelete line 36): try? VaultStorage.shared.deleteFile() silently ignores failures. UI removes file from grid and shows 'deleted' toast even when delete failed. Fix: propagate the error ‚Äî show error toast and keep file in list if delete fails.","status":"closed","priority":1,"issue_type":"bug","owner":"r@turek.co","created_at":"2026-02-17T20:37:03.640436-08:00","created_by":"ehmo","updated_at":"2026-02-17T20:53:35.973596-08:00","closed_at":"2026-02-17T20:53:35.973596-08:00","close_reason":"Closed"}
{"id":"VAULT-2uc","title":"WS6: Smart empty state walkthrough","status":"closed","priority":2,"issue_type":"feature","owner":"r@turek.co","created_at":"2026-02-08T23:12:53.87975-08:00","created_by":"ehmo","updated_at":"2026-02-08T23:13:43.759023-08:00","closed_at":"2026-02-08T23:13:43.759023-08:00","close_reason":"Closed"}
{"id":"VAULT-30m","title":"[Test-7] Audit all XCTAssertThrowsError calls, add specific error type assertions","description":"Multiple XCTAssertThrowsError calls across the test suite check only that SOME error is thrown, not the SPECIFIC error type. This allows error type regressions to go undetected.\n\nPLAN:\n1. grep -r 'XCTAssertThrowsError' in VaultTests/ to find all instances\n2. For each, add a closure that asserts the specific error type:\n   XCTAssertThrowsError(try CryptoEngine.decrypt(corrupted, with: key)) { error in\n       XCTAssertTrue(error is CryptoError, 'Expected CryptoError, got \\(type(of: error))')\n   }\n3. Known weak assertions:\n   - CryptoEngineTests.swift:27-32 (testDecryptCorruptedDataThrows)\n   - Look for similar patterns in VaultStorageIntegrationTests, ShareRoundTripTests, etc.\n\nFile: all files in apps/ios/VaultTests/\nTEST: All existing tests should still pass after adding error type assertions.","status":"open","priority":3,"issue_type":"task","owner":"r@turek.co","created_at":"2026-02-23T13:31:26.980711-08:00","created_by":"ehmo","updated_at":"2026-02-23T13:31:26.980711-08:00"}
{"id":"VAULT-33f","title":"[Arch-3] Extract shared post-unlock setup to eliminate DRY violation","description":"unlockWithPattern (VaultApp.swift:218-327) and unlockWithKey (VaultApp.swift:332-385) duplicate ~35 lines of post-unlock logic:\n- Index loading + shared vault detection (lines 283-291 ‚âà 357-365)\n- Staged import cleanup (lines 294-304 ‚âà 368-378)\n- Share upload resume (line 306 ‚âà 380)\n- Transaction finishing\n\nFIX: Extract a private performPostUnlockSetup(key: Data, transaction: EmbraceTransaction) method in AppState. Both unlock paths call it after setting currentVaultKey/isUnlocked.\n\nTest: Existing unlock tests should still pass. Add test verifying both paths produce identical post-unlock state.","status":"open","priority":2,"issue_type":"task","owner":"r@turek.co","created_at":"2026-02-23T12:02:57.52942-08:00","created_by":"ehmo","updated_at":"2026-02-23T12:02:57.52942-08:00"}
{"id":"VAULT-34m","title":"[Test-2] Add streaming encryption tamper and round-trip tests","description":"CryptoEngine VCSE streaming format has anti-tamper (nonce XOR ordering) that is NEVER tested. chunkOrderingViolation error path exists at 3 locations but zero tests verify it.\n\nTESTS TO WRITE (add to VaultTests/CryptoEngineTests.swift):\n1. testStreamingEncryptDecryptRoundTrip - encrypt file \u003e1MB, decrypt, verify identical\n2. testStreamingWithReorderedChunksThrowsOrderingViolation - construct valid VCSE, swap 2 chunks, assert CryptoError.chunkOrderingViolation\n3. testStreamingWithTruncatedLastChunk - remove last chunk, verify CryptoError.invalidData\n4. testStreamingAtExactThresholdBoundary - file at exactly streamingThreshold bytes (1MB) and +1 byte\n5. testEncryptDecryptEmptyData - Data() round-trip\n6. testXorNonceWithZeroIndex - verify xorNonce(base, 0) == base\n7. testXorNonceWithMaxIndex - xorNonce(base, UInt64.max)\n8. testEncryptFileStreamingToHandle - use temp FileHandle, verify output decryptable\n9. testDecryptStreamingFromHandleToFile - round-trip via FileHandle\n10. testDecryptStagedDetectsFormat - isStreamingFormat for both formats\n\nFile: apps/ios/Vault/Core/Crypto/CryptoEngine.swift (source)\nFile: apps/ios/VaultTests/CryptoEngineTests.swift (add tests)","status":"open","priority":1,"issue_type":"task","owner":"r@turek.co","created_at":"2026-02-23T13:30:33.828443-08:00","created_by":"ehmo","updated_at":"2026-02-23T13:30:33.828443-08:00"}
{"id":"VAULT-355","title":"Enable TSAN + add concurrent access tests","description":"TEST #27: No concurrency/thread safety tests. @MainActor await omissions regressed 3+ times. VaultStorage uses NSRecursiveLock but no TSAN coverage.\n\nIMPLEMENTATION:\nPhase 1: Enable Strict Concurrency (overlaps with VAULT-sny)\nPhase 2: Enable Thread Sanitizer in test scheme\nPhase 3: Add concurrent access tests:\n- Test: concurrent file store + retrieve on VaultStorage\n- Test: concurrent sync + read operations\n- Test: background task + UI update races\n- Test: concurrent thumbnail cache access\n\nKEY FILES: Vault.xcscheme (enable TSAN), VaultTests/ (new test files)\nDEPENDS ON: VAULT-sny (strict concurrency) should be done first for compile-time checks","status":"closed","priority":3,"issue_type":"task","owner":"r@turek.co","created_at":"2026-02-21T11:37:59.711328-08:00","created_by":"ehmo","updated_at":"2026-02-21T12:58:17.738428-08:00","closed_at":"2026-02-21T12:58:17.738428-08:00","close_reason":"Closed","dependencies":[{"issue_id":"VAULT-355","depends_on_id":"VAULT-sny","type":"blocks","created_at":"2026-02-21T11:38:44.504711-08:00","created_by":"ehmo"}]}
{"id":"VAULT-3bm","title":"Add serial DispatchQueue for VaultStorage index ops","description":"VaultStorage.loadIndex/saveIndex have no concurrency protection. Add a serial DispatchQueue wrapping index read/write to prevent races between VaultView, ShareSyncManager, BackgroundShareTransferManager.","status":"closed","priority":1,"issue_type":"task","owner":"r@turek.co","created_at":"2026-02-11T22:00:39.020738-08:00","created_by":"ehmo","updated_at":"2026-02-11T22:13:49.240933-08:00","closed_at":"2026-02-11T22:13:49.240933-08:00","close_reason":"Implemented NSRecursiveLock for VaultStorage index serialization. Compound methods (storeFile, deleteFile, deleteFiles, changeVaultKey, compactBlobs) hold lock across load+modify+save. Read-only methods use public loadIndex wrapper."}
{"id":"VAULT-3fw","title":"Perf: Size guard in SVDFSerializer.buildIncremental() for large vault protection","description":"SVDFSerializer.buildIncremental() copies entire prior SVDF Data (priorData.prefix(fileEntriesEnd)) into output ‚Äî up to hundreds of MB for large vaults. Short-term fix: add size check, refuse in-memory above threshold and require streaming path. Long-term: rewrite with FileHandle copy ranges.","status":"closed","priority":4,"issue_type":"task","owner":"r@turek.co","created_at":"2026-02-17T20:38:35.077066-08:00","created_by":"ehmo","updated_at":"2026-02-17T22:42:10.038559-08:00","closed_at":"2026-02-17T22:42:10.038559-08:00","close_reason":"Closed"}
{"id":"VAULT-3j7","title":"WS8: Expandable info sections","status":"closed","priority":2,"issue_type":"feature","owner":"r@turek.co","created_at":"2026-02-08T23:14:37.319753-08:00","created_by":"ehmo","updated_at":"2026-02-08T23:15:26.885314-08:00","closed_at":"2026-02-08T23:15:26.885314-08:00","close_reason":"Closed"}
{"id":"VAULT-3os","title":"Parallel chunk downloads with TaskGroup","description":"downloadSharedVault uses serial for loop for chunk downloads (N+1 pattern). Use TaskGroup with concurrency limit of 4 matching upload pattern.","status":"closed","priority":2,"issue_type":"task","owner":"r@turek.co","created_at":"2026-02-11T22:01:09.550757-08:00","created_by":"ehmo","updated_at":"2026-02-11T22:47:31.977088-08:00","closed_at":"2026-02-11T22:47:31.977088-08:00","close_reason":"Closed"}
{"id":"VAULT-3q6","title":"Perf: Spatial grid index for drag hit-testing in PhotosGridView/FilesGridView","description":"PhotosGridView.swift:139-141 (also FilesGridView.swift:162-163): cellId(at:) does O(n) linear scan through cellFrames on every drag .onChanged event. Fix: build [[UUID?]] spatial grid index from cellFrames once when grid layout changes; O(1) lookup by computed row/col.","status":"closed","priority":3,"issue_type":"task","owner":"r@turek.co","created_at":"2026-02-17T20:38:23.654202-08:00","created_by":"ehmo","updated_at":"2026-02-17T22:45:35.169292-08:00","closed_at":"2026-02-17T22:45:35.169292-08:00","close_reason":"Deferred: cellFrames only contains visible cells (~20-50), O(n) scan is negligible vs rendering cost. Spatial grid index would be over-engineering."}
{"id":"VAULT-3xf","title":"Incremental iCloud backup (per-blob encryption)","description":"Current v2 backup packs ALL blob data + index files into a single encrypted payload, then chunks for CloudKit upload. Every backup is a full re-upload. Design and implement per-blob encryption so only changed/deleted blobs need uploading. Key architectural changes: encrypt each blob individually, track blobs as separate CloudKit records, use content-addressable hashing to skip unchanged blobs. Trade-off: more complexity but O(delta) uploads instead of O(vault-size).","status":"open","priority":3,"issue_type":"feature","owner":"r@turek.co","created_at":"2026-02-22T09:11:45.535066-08:00","created_by":"ehmo","updated_at":"2026-02-22T09:11:45.535066-08:00"}
{"id":"VAULT-43m","title":"[CQ-8] Replace nonisolated(unsafe) isPremiumSnapshot with @MainActor","description":"DATA RACE: SubscriptionManager.swift:240 has:\n  nonisolated(unsafe) static var isPremiumSnapshot: Bool = false\n\nWritten from @MainActor, read from any thread. nonisolated(unsafe) explicitly opts out of Swift concurrency safety. Will be flagged under Swift 6 strict concurrency.\n\nFIX (Option A): Replace with @MainActor static property:\n  @MainActor static var isPremiumSnapshot: Bool = false\n\nUpdate all off-main-actor callers to either:\n- Read via await MainActor.run { SubscriptionManager.isPremiumSnapshot }\n- Cache the value locally before going off-main\n\nFile: SubscriptionManager.swift:240\nTEST: Verify all callers compile. Run with TSan enabled to confirm no races.","status":"open","priority":2,"issue_type":"bug","owner":"r@turek.co","created_at":"2026-02-23T13:24:51.46928-08:00","created_by":"ehmo","updated_at":"2026-02-23T13:24:51.46928-08:00"}
{"id":"VAULT-452","title":"[Perf-10] Add thumbnail prefetch for cells approaching visible area","description":"ThumbnailCache decrypts thumbnails on-demand per visible cell. No prefetch for cells about to scroll into view. NSCache limit of 500 means scrolling back triggers re-decryptions.\n\nPLAN:\n1. In PhotosGridView, detect scroll direction and prefetch thumbnails for the next ~20 cells\n2. Use onAppear on sentinel cells (every Nth cell) to trigger batch prefetch\n3. Or: increase NSCache to 1000 and implement background batch decrypt on loadFiles()\n4. Consider disk-backed cache (encrypted thumbnails already stored in index ‚Äî decrypt once, cache to temp file)\n\nALTERNATIVE: Prefetch in VaultViewModel.loadFiles() by decrypting first N thumbnails (N = visible cells * 2) immediately after file list loads\n\nNOTE: Per-decrypt is ~0.1ms so this is low priority. Only address if users report scrolling issues with 500+ files.\n\nFile: apps/ios/Vault/Core/Cache/ThumbnailCache.swift\nFile: apps/ios/Vault/Features/VaultViewer/PhotosGridView.swift\nTEST: Profile scroll performance before/after with 500+ file vault.","status":"open","priority":4,"issue_type":"task","owner":"r@turek.co","created_at":"2026-02-23T13:38:46.952721-08:00","created_by":"ehmo","updated_at":"2026-02-23T13:38:46.952721-08:00"}
{"id":"VAULT-4bd","title":"Replace full-screen blocking spinner with skeleton view","description":"VaultView.swift:128-129 shows ProgressView('Loading vault...') blocking the entire view. Replace with skeleton grid cells using .redacted(reason: .placeholder) matching PhotosGridView 3-column layout.","status":"closed","priority":1,"issue_type":"bug","owner":"r@turek.co","created_at":"2026-02-01T15:10:14.564613-08:00","created_by":"ehmo","updated_at":"2026-02-01T15:16:55.607803-08:00","closed_at":"2026-02-01T15:16:55.607803-08:00","close_reason":"Replaced ProgressView('Loading vault...') blocking spinner with a 3-column skeleton grid of 12 placeholder tiles using .redacted(reason: .placeholder). Matches PhotosGridView layout so transition is seamless."}
{"id":"VAULT-4ce","title":"[Arch-4] Convert VaultIndexManager to Swift actor for concurrency safety","description":"VaultStorage is final class (not actor) using NSRecursiveLock + DispatchQueue for thread safety. Comment in VaultStorage.swift:33-36 acknowledges 'Full actor refactor deferred to future work.' Accessed from @MainActor views, Task.detached workers, and share extension simultaneously.\n\nPLAN:\n1. Convert VaultIndexManager to actor (it's the critical section for all index ops)\n2. Make loadIndex/saveIndex/getMasterKey async\n3. Update VaultStorage to call VaultIndexManager via await\n4. Remove NSRecursiveLock from VaultIndexManager\n5. Update all callers: storeFile, deleteFile, retrieveFile, changeVaultKey, compactBlobs etc.\n6. Keep VaultStorage as a class (blocking file I/O would starve cooperative pool if it were an actor)\n\nRISK: async propagation through 30+ call sites. Do this when touching VaultStorage for other work.\n\nFiles: VaultIndexManager.swift (main change), VaultStorage.swift (caller updates), all Features that call storage","status":"open","priority":2,"issue_type":"task","owner":"r@turek.co","created_at":"2026-02-23T12:03:13.524868-08:00","created_by":"ehmo","updated_at":"2026-02-23T12:03:13.524868-08:00"}
{"id":"VAULT-4fm","title":"VaultStorage integration tests with temp directory","description":"Zero tests for core storage path. Test store/list/retrieve/delete round-trip, changeVaultKey verification, index Codable round-trips using temp directory.","status":"closed","priority":2,"issue_type":"task","owner":"r@turek.co","created_at":"2026-02-11T22:01:06.187354-08:00","created_by":"ehmo","updated_at":"2026-02-13T16:55:07.210906-08:00","closed_at":"2026-02-13T16:55:07.210906-08:00","close_reason":"Implemented VaultStorageIntegrationTests (10 tests) and PatternSetupCoordinator with PatternSetupCoordinatorTests (6 tests). All 165 tests pass."}
{"id":"VAULT-52z","title":"Tests: EncryptedBlobTests ‚Äî blob cursor/offset correctness","description":"EncryptedBlob.swift has zero unit tests. Manages raw file I/O at specific offsets in pre-allocated random-data blobs. Write tests: read/write at specific offsets, cursor persistence across FileHandle open/close cycles, expansion creates new blob, boundary writes (at end of blob). Use temp files.","status":"closed","priority":1,"issue_type":"task","owner":"r@turek.co","created_at":"2026-02-17T20:36:51.698585-08:00","created_by":"ehmo","updated_at":"2026-02-17T21:12:52.623998-08:00","closed_at":"2026-02-17T21:12:52.623998-08:00","close_reason":"Closed"}
{"id":"VAULT-53p","title":"[Perf-7] Replace O(N) nearestItemIndex with O(1) grid math","description":"PhotosGridView.nearestItemIndex() (lines 189-200) iterates ALL files computing Euclidean distance to find nearest cell. Called twice per drag gesture update at 60fps. 500 files = 60K distance calcs/second.\n\nFIX: Replace with O(1) row/column arithmetic:\n  let col = max(0, min(columns - 1, Int(point.x / (cellWidth + spacing))))\n  let row = max(0, min(rowCount - 1, Int(point.y / (cellHeight + spacing))))\n  let index = row * columns + col\n  return index \u003c files.count ? index : files.count - 1\n\nNeeds: column count, cellWidth, cellHeight, spacing ‚Äî all available from the grid layout.\n\nFile: apps/ios/Vault/Features/VaultViewer/PhotosGridView.swift:189-200\nTEST: Verify drag-to-select works correctly at grid edges, first/last items, and mid-grid.","status":"open","priority":3,"issue_type":"task","owner":"r@turek.co","created_at":"2026-02-23T13:38:20.492337-08:00","created_by":"ehmo","updated_at":"2026-02-23T13:38:20.492337-08:00"}
{"id":"VAULT-59m","title":"Security: performLoadIndex silently returns empty vault on wrong key or corruption","description":"VaultStorage.performLoadIndex() catches decryption failure and returns a brand-new empty VaultIndex instead of throwing. Wrong pattern shows empty vault. Corrupted index is silently replaced. No error propagated to caller. Fix: throw VaultError.decryptionFailed on index decrypt failure. Update call sites in AppState to distinguish wrong-key from corruption. VaultStorage.swift:447-473.","status":"closed","priority":0,"issue_type":"bug","owner":"r@turek.co","created_at":"2026-02-17T20:36:29.643288-08:00","created_by":"ehmo","updated_at":"2026-02-17T20:45:17.468762-08:00","closed_at":"2026-02-17T20:45:17.468762-08:00","close_reason":"Closed"}
{"id":"VAULT-5bj","title":"[Arch-6] Extract UnlockCeremony and AppearanceManager from AppState","description":"AppState is a 420+ line God Object with 15+ responsibilities: unlock state, key storage, pattern storage, vault name, shared vault detection, loading state, screenshot detection, pending imports, appearance mode, onboarding, recovery phrase flag, test mode, lock generation, key provider registration, Maestro test seeding.\n\nPLAN:\n1. Extract AppearanceManager (@Observable):\n   - Move appearanceMode, effectiveInterfaceStyle, launchBackgroundColor, setAppearanceMode(), applyAppearanceToAllWindows()\n   - ~40 lines from VaultApp.swift:96-215\n   - Inject into SwiftUI environment\n\n2. Extract UnlockCeremony (@Observable):\n   - Move unlockWithPattern(), unlockWithKey(), performPostUnlockSetup() (from Arch-3)\n   - ~120 lines from VaultApp.swift:218-385\n   - Takes AppState as dependency for setting isUnlocked/currentVaultKey\n\n3. AppState retains: isUnlocked, currentVaultKey, currentPattern, lockVault(), lockGeneration, onboarding state\n   - Becomes ~150 lines instead of 420\n\nDEPENDS ON: Arch-3 (DRY fix should happen first to avoid extracting duplicated code)\n\nFiles: VaultApp.swift:78-508","status":"open","priority":3,"issue_type":"task","owner":"r@turek.co","created_at":"2026-02-23T12:03:27.998275-08:00","created_by":"ehmo","updated_at":"2026-02-23T12:03:27.998275-08:00","dependencies":[{"issue_id":"VAULT-5bj","depends_on_id":"VAULT-33f","type":"blocks","created_at":"2026-02-23T12:04:10.926696-08:00","created_by":"ehmo"}]}
{"id":"VAULT-5f8","title":"Add DeepLinkHandler URL parsing tests","description":"TEST #24: DeepLinkHandler parses vaultaire:// URLs for share link routing. 25 lines but untested. Malformed URLs from browsers/message apps are a real vector.\n\nCreate DeepLinkHandlerTests.swift:\n- Test: valid share URL extracts token\n- Test: invalid scheme rejected\n- Test: missing token handled gracefully\n- Test: malformed URL handled gracefully\n- Test: fragment-only URL (vaultaire://share#token)\n- Test: query-parameter fallback (vaultaire://share?p=token)\n- Test: URL-encoded special characters\n\nKEY FILES:\n- apps/ios/Vault/Core/Sharing/DeepLinkHandler.swift (25 lines)\n- apps/ios/VaultTests/ShareLinkEncoderTests.swift (tests URL construction, not consumption)","status":"closed","priority":2,"issue_type":"task","owner":"r@turek.co","created_at":"2026-02-21T11:37:40.629778-08:00","created_by":"ehmo","updated_at":"2026-02-21T12:26:17.000893-08:00","closed_at":"2026-02-21T12:26:17.000893-08:00","close_reason":"13 tests: valid/invalid URLs, scheme validation, fragment handling, round-trip, overwrite behavior."}
{"id":"VAULT-5lm","title":"[CQ-6] Decompose ShareUploadManager into 3 focused types","description":"ShareUploadManager.swift is 1367 lines with 4+ mixed concerns: upload job lifecycle, job persistence (UserDefaults serialization), chunk splitting/upload, network monitoring integration, legacy migration, progress tracking.\n\nPLAN:\n1. Create UploadJobStore (new file):\n   - Job persistence: encode/decode to UserDefaults\n   - Job lifecycle: create, update status, delete\n   - Job queries: pending, stale, for-share-vault-id\n   - Legacy format migration\n\n2. Create ChunkUploader (new file):\n   - Split data into chunks\n   - Upload chunks to CloudKit with retry\n   - Progress reporting\n   - Diff-based upload (only changed chunks)\n\n3. ShareUploadManager becomes orchestrator:\n   - Uses UploadJobStore for persistence\n   - Uses ChunkUploader for CloudKit operations\n   - Handles debouncing, background task scheduling\n   - Coordinates with AppState for vault key\n\nFiles: Core/Sharing/ShareUploadManager.swift (refactor), new Core/Sharing/UploadJobStore.swift, new Core/Sharing/ChunkUploader.swift\nTEST: Existing upload tests should pass. Add unit tests for UploadJobStore and ChunkUploader independently.","status":"open","priority":2,"issue_type":"task","owner":"r@turek.co","created_at":"2026-02-23T13:24:45.879346-08:00","created_by":"ehmo","updated_at":"2026-02-23T13:24:45.879346-08:00"}
{"id":"VAULT-5p7","title":"Add SecureVideoPlayer tests (unit + Maestro)","description":"TEST #25: SecureVideoPlayer has no unit tests AND no Maestro coverage. Handles decrypt-to-temp, AVPlayer creation, temp file cleanup. Security concern: decrypted video must not persist.\n\nIMPLEMENTATION:\n1. SecureVideoPlayerTests.swift:\n   - Test: temp file created during playback\n   - Test: AVPlayer receives correct temp URL\n   - Test: temp file cleaned up on dismiss\n   - Test: temp file cleaned up on dealloc\n   - Test: cleanup happens even on error\n   - Test: file protection level of temp file\n2. Maestro flow: maestro/flows/viewer/play_video.yaml:\n   - Import test video (short .mp4)\n   - Open video from vault grid\n   - Verify player controls visible\n   - Dismiss\n\nKEY FILES:\n- apps/ios/Vault/Features/VaultViewer/SecureVideoPlayer.swift","status":"closed","priority":2,"issue_type":"task","owner":"r@turek.co","created_at":"2026-02-21T11:37:46.282981-08:00","created_by":"ehmo","updated_at":"2026-02-21T12:46:58.850149-08:00","closed_at":"2026-02-21T12:46:58.850149-08:00","close_reason":"SecureVideoPlayer is a tightly coupled SwiftUI view. Core security (SecureDelete, temp file cleanup) already tested in SecureDeleteTests. Meaningful testing requires Maestro E2E with pre-configured vault state ‚Äî deferring to dedicated E2E pass."}
{"id":"VAULT-5vs","title":"WS1: Date-grouped file grid","status":"closed","priority":1,"issue_type":"feature","owner":"r@turek.co","created_at":"2026-02-08T23:02:34.567194-08:00","created_by":"ehmo","updated_at":"2026-02-08T23:05:08.571175-08:00","closed_at":"2026-02-08T23:05:08.571175-08:00","close_reason":"Closed"}
{"id":"VAULT-5vy","title":"Extract shared CKDatabase.saveWithRetry extension","description":"CODE QUALITY #11 + #15: Duplicate saveWithRetry in CloudKitSharingManager (lines 840-905) and iCloudBackupManager (lines 880-918). Subtly different backoff formulas and error handling. Also standardizes backoff strategy across codebase.\n\nIMPLEMENTATION:\n1. Create new file: Core/Sharing/CKDatabase+Retry.swift\n2. Define extension on CKDatabase:\n   ```swift\n   extension CKDatabase {\n       func saveWithRetry(_ record: CKRecord, policy: RetryPolicy = .default) async throws\n   }\n   ```\n3. Define RetryPolicy struct:\n   ```swift\n   struct RetryPolicy {\n       let maxRetries: Int\n       let baseDelay: TimeInterval\n       let backoffMultiplier: Double\n       static let default = RetryPolicy(maxRetries: 3, baseDelay: 1.0, backoffMultiplier: 2.0)\n   }\n   ```\n4. Handle: serverRecordChanged (fetch+retry), transient errors (backoff), retryAfterSeconds\n5. Replace both duplicate implementations with the extension call\n6. Also add deleteWithRetry for orphan chunk cleanup (Issue #13)\n\nKEY FILES:\n- apps/ios/Vault/Core/Sharing/CloudKitSharingManager.swift (lines 840-905, remove)\n- apps/ios/Vault/Core/Storage/iCloudBackupManager.swift (lines 880-918, remove)\n- New: apps/ios/Vault/Core/Sharing/CKDatabase+Retry.swift\n\nTESTS NEEDED:\n- Unit test: retry on transient errors\n- Unit test: backoff timing\n- Unit test: serverRecordChanged fetch-and-retry\n- Unit test: respects retryAfterSeconds","status":"closed","priority":2,"issue_type":"task","owner":"r@turek.co","created_at":"2026-02-21T11:36:39.357513-08:00","created_by":"ehmo","updated_at":"2026-02-21T12:36:29.208319-08:00","closed_at":"2026-02-21T12:36:29.208319-08:00","close_reason":"Extracted CKDatabase+Retry.swift with saveWithRetry and deleteWithRetry, replaced both duplicates"}
{"id":"VAULT-60w","title":"Reset iCloud backup clock on duress trigger (24h restore window)","description":"When duress mode is triggered, reset the iCloud backup deletion/expiration clock to give the user 24 hours to restore their data from iCloud backup before it's gone. Currently duress destroys local data but doesn't account for the backup retention window.","status":"open","priority":1,"issue_type":"feature","owner":"r@turek.co","created_at":"2026-02-22T16:27:26.830879-08:00","created_by":"ehmo","updated_at":"2026-02-22T16:27:26.830879-08:00"}
{"id":"VAULT-624","title":"Bug: checkPhraseAvailability returns .success on network error ‚Äî confusing failure later","description":"ShareUploadManager.swift:96-98: network errors return .success(()), allowing user to proceed with a possibly-claimed phrase. Results in a generic 'upload failed' with no explanation. Fix: distinguish network error from 'phrase available' ‚Äî surface retryable error state ('Can't verify phrase ‚Äî check connection') before allowing user to proceed.","status":"closed","priority":2,"issue_type":"bug","owner":"r@turek.co","created_at":"2026-02-17T20:37:51.296295-08:00","created_by":"ehmo","updated_at":"2026-02-17T21:17:19.364547-08:00","closed_at":"2026-02-17T21:17:19.364547-08:00","close_reason":"Closed"}
{"id":"VAULT-6i6","title":"Extract ShareImportManager from BackgroundShareTransferManager","description":"ARCHITECTURE #1: BackgroundShareTransferManager (1387 lines) has ~700 lines of dead upload code superseded by ShareUploadManager. Only the download+import path is live (used by JoinVaultView).\n\nACTION:\n1. Create new ShareImportManager.swift in Core/Sharing/\n2. Move download+import logic (~600 lines) from BackgroundShareTransferManager: startBackgroundDownloadAndImport(), PendingImportState, importedFileIds checkpoint logic, download retry (3 attempts, 2s/4s/10s backoff), per-file import with progress callbacks\n3. Move BGProcessingTask registration for import (NOT upload - that stays with ShareUploadManager)\n4. Update JoinVaultView.swift to use ShareImportManager instead of BackgroundShareTransferManager\n5. Update VaultView+SharedVault.swift if it references BackgroundShareTransferManager for import\n6. Update VaultApp.swift - remove BackgroundShareTransferManager from environment/init\n7. Delete BackgroundShareTransferManager.swift entirely\n8. Delete BackgroundShareTransferTests.swift (#if false dead tests)\n9. Write new ShareImportManagerTests.swift with MockImportCloudKitSharing\n\nThe duplicate PendingUploadState, UploadLifecycleMarker, and upload code all go away with this deletion.\n\nKEY FILES:\n- Source: apps/ios/Vault/Core/Sharing/BackgroundShareTransferManager.swift (1387 lines)\n- Active upload manager: apps/ios/Vault/Core/Sharing/ShareUploadManager.swift (1344 lines)\n- Consumer: apps/ios/Vault/Features/Sharing/JoinVaultView.swift\n- Consumer: apps/ios/Vault/Features/VaultViewer/VaultView+SharedVault.swift\n- Dead tests: apps/ios/VaultTests/BackgroundShareTransferTests.swift\n\nRISKS: Import paths need careful testing. Ensure PendingImportState file format is preserved for in-flight imports during the migration.","status":"closed","priority":1,"issue_type":"task","owner":"r@turek.co","created_at":"2026-02-21T11:35:25.679944-08:00","created_by":"ehmo","updated_at":"2026-02-21T11:58:36.274397-08:00","closed_at":"2026-02-21T11:58:36.274397-08:00","close_reason":"Extracted ShareImportManager from BackgroundShareTransferManager. Deleted 1387-line file with ~680 dead upload lines, replaced with focused 430-line import-only manager."}
{"id":"VAULT-6id","title":"Switch to constant-time HMAC comparison","description":"CODE QUALITY #18: CryptoEngine.swift line 659 compares HMAC with == instead of constant-time comparison.\n\nFIX: Replace manual hmac == computed with HMAC\u003cSHA256\u003e.isValidAuthenticationCode() from CryptoKit. \n\nFILE: apps/ios/Vault/Core/Crypto/CryptoEngine.swift, line ~659\nEFFORT: 15 minutes","status":"closed","priority":3,"issue_type":"task","owner":"r@turek.co","created_at":"2026-02-21T11:37:04.946902-08:00","created_by":"ehmo","updated_at":"2026-02-21T12:42:56.302466-08:00","closed_at":"2026-02-21T12:42:56.302466-08:00","close_reason":"Replaced hmac == computed with HMAC\u003cSHA256\u003e.isValidAuthenticationCode()"}
{"id":"VAULT-6mj","title":"Add Reduce Motion support","description":"WelcomeView pulsating animation runs .repeatForever() without checking accessibilityReduceMotion. Spring animations on PatternLockView error also ignore preference. Affects WelcomeView.swift:24, ContentView.swift:19-21, PatternLockView.swift:83.","status":"closed","priority":0,"issue_type":"bug","owner":"r@turek.co","created_at":"2026-02-01T15:10:09.570742-08:00","created_by":"ehmo","updated_at":"2026-02-01T15:14:33.058783-08:00","closed_at":"2026-02-01T15:14:33.058783-08:00","close_reason":"Added @Environment accessibilityReduceMotion checks to: WelcomeView pulsating animation, ContentView state transitions, PatternLockView error spring animation, FullScreenPhotoViewer drag-to-dismiss spring, OnboardingView step transitions. All decorative animations now disabled when Reduce Motion is on."}
{"id":"VAULT-6qy","title":"Unit tests for ShareLinkEncoder and RecoveryPhraseGenerator","description":"Zero tests for share link encode/decode and recovery phrase generation/validation. Write round-trip tests, edge cases, validation category tests.","status":"closed","priority":1,"issue_type":"task","owner":"r@turek.co","created_at":"2026-02-11T22:01:00.84282-08:00","created_by":"ehmo","updated_at":"2026-02-11T22:20:24.370981-08:00","closed_at":"2026-02-11T22:20:24.370981-08:00","close_reason":"136 tests passing: PatternValidator (20), PatternSerializer (29), KeyDerivation (11), ShareLinkEncoder (20), RecoveryPhraseGenerator (19). Also fixed analyzePattern crash on empty patterns."}
{"id":"VAULT-6zv","title":"WS11: Premium hero card + inline limits","status":"closed","priority":2,"issue_type":"task","owner":"r@turek.co","created_at":"2026-02-08T23:19:24.166904-08:00","created_by":"ehmo","updated_at":"2026-02-08T23:19:28.910387-08:00","closed_at":"2026-02-08T23:19:28.910387-08:00","close_reason":"Implemented and build verified"}
{"id":"VAULT-70t","title":"Tests: SecureDeleteTests ‚Äî verify 3-pass overwrite actually executes","description":"SecureDelete.swift has zero unit tests. The 3-pass overwrite (zeros, ones, random) is a core app promise. Write SecureDeleteTests: create temp file, run secureDelete, verify file doesn't exist after, verify overwrite passes executed (can check that file bytes changed). Low-medium effort.","status":"closed","priority":1,"issue_type":"task","owner":"r@turek.co","created_at":"2026-02-17T20:36:51.576514-08:00","created_by":"ehmo","updated_at":"2026-02-17T21:12:52.607805-08:00","closed_at":"2026-02-17T21:12:52.607805-08:00","close_reason":"Closed"}
{"id":"VAULT-7ax","title":"WS9: Settings reorganization","status":"closed","priority":2,"issue_type":"task","owner":"r@turek.co","created_at":"2026-02-08T23:15:32.083473-08:00","created_by":"ehmo","updated_at":"2026-02-08T23:16:11.977729-08:00","closed_at":"2026-02-08T23:16:11.977729-08:00","close_reason":"Closed"}
{"id":"VAULT-7up","title":"Refactor: Extract VaultViewModel from VaultView mega-view","description":"VaultView.swift has ~30 @State properties across 525 lines + 5 extension files. Import state, batch selection, share upload state, paywall, fan menu all mixed together. Views call VaultStorage.shared, ShareUploadManager.shared, BackgroundShareTransferManager.shared directly. Extract VaultViewModel: ObservableObject for non-UI logic. Combine with VaultImportCoordinator extraction (C10).","status":"closed","priority":2,"issue_type":"task","owner":"r@turek.co","created_at":"2026-02-17T20:37:29.030828-08:00","created_by":"ehmo","updated_at":"2026-02-17T22:57:00.073997-08:00","closed_at":"2026-02-17T22:57:00.073997-08:00","close_reason":"Closed"}
{"id":"VAULT-88m","title":"[Arch-9] Auto-compact blobs when deleted space exceeds 30% threshold","description":"Deleted files have their blob space overwritten with random bytes (good for security) but space is never reclaimed automatically. Compaction exists (VaultStorage.compactBlobs) but must be triggered manually. Users who import/delete many files exhaust 50MB blob without recovery.\n\nPLAN:\n1. After deleteFile/deleteFiles, check deletedSpace(for:index) / totalUsed(for:index) \u003e 0.3\n2. If threshold exceeded, queue a background compaction task (don't block the delete)\n3. Use Task.detached with low priority to avoid impacting UI\n4. Add telemetry span for compaction events\n5. Show subtle UI indicator when compaction is running\n6. Use same 30% threshold as SVDF serializer for consistency\n\nFiles: VaultStorage.swift:748-846 (delete methods), VaultStorage.swift:1176-1315 (compaction)\nTest: Add test that stores files, deletes \u003e30%, verifies compaction is triggered and space is reclaimed.","status":"open","priority":3,"issue_type":"feature","owner":"r@turek.co","created_at":"2026-02-23T12:03:54.948414-08:00","created_by":"ehmo","updated_at":"2026-02-23T12:03:54.948414-08:00"}
{"id":"VAULT-8bz","title":"Security: Silent secure delete failure ‚Äî plaintext persists in blob on RNG failure","description":"In VaultStorage.deleteFile() and deleteFiles(), if CryptoEngine.generateRandomBytes() returns nil, the index marks the entry deleted but the blob region is NOT overwritten. Sensitive plaintext persists. Fix: throw on RNG failure, roll back the index change. Also affects secureOverwrite() and createRandomBlob(). VaultStorage.swift:1098-1099, 1146-1148, 1402-1405.","status":"closed","priority":0,"issue_type":"bug","owner":"r@turek.co","created_at":"2026-02-17T20:36:29.510234-08:00","created_by":"ehmo","updated_at":"2026-02-17T20:45:17.454397-08:00","closed_at":"2026-02-17T20:45:17.454397-08:00","close_reason":"Closed"}
{"id":"VAULT-8pj","title":"Task.detached for handleCapturedImage and deleteFileById","description":"VaultView.handleCapturedImage and deleteFileById use Task{} inheriting MainActor. Encryption/IO runs on main thread causing UI freeze. Use Task.detached.","status":"closed","priority":1,"issue_type":"task","owner":"r@turek.co","created_at":"2026-02-11T22:01:11.130397-08:00","created_by":"ehmo","updated_at":"2026-02-11T22:04:43.406181-08:00","closed_at":"2026-02-11T22:04:43.406181-08:00","close_reason":"Closed"}
{"id":"VAULT-8wd","title":"WS10: Toolbar storage indicator","status":"closed","priority":2,"issue_type":"task","owner":"r@turek.co","created_at":"2026-02-08T23:19:23.126627-08:00","created_by":"ehmo","updated_at":"2026-02-08T23:19:28.885433-08:00","closed_at":"2026-02-08T23:19:28.885433-08:00","close_reason":"Implemented and build verified"}
{"id":"VAULT-8xb","title":"Perf: Deprecate and audit encryptStreaming(fileURL:) ‚Äî misleading non-streaming method","description":"CryptoEngine.swift:407: encryptStreaming(fileURL:) reads chunks but accumulates entire output in a single Data (50MB file = 50MB Data). True streaming variant encryptFileStreamingToHandle() exists. Fix: mark encryptStreaming(fileURL:) @available(*, deprecated, renamed: encryptFileStreamingToHandle). Audit and redirect all call sites.","status":"closed","priority":4,"issue_type":"task","owner":"r@turek.co","created_at":"2026-02-17T20:38:34.958583-08:00","created_by":"ehmo","updated_at":"2026-02-17T22:42:10.036637-08:00","closed_at":"2026-02-17T22:42:10.036637-08:00","close_reason":"Closed"}
{"id":"VAULT-98s","title":"Use file-based upload everywhere (eliminate SVDF Data loading)","description":"CODE QUALITY #16: BackgroundShareTransferManager line 630 loads entire SVDF into Data. OOM risk for large vaults in background context. CloudKitSharingManager already has uploadChunksFromFile() that reads chunks from disk on demand.\n\nIMPLEMENTATION:\n1. In ShareUploadManager: replace any Data(contentsOf: svdfURL) + uploadChunksParallel(data:) with uploadChunksFromFile(url:)\n2. In BackgroundShareTransferManager (if still exists after #1): same replacement\n3. Verify all upload code paths use file-based streaming\n\nThis may be partially resolved by Issue VAULT-6i6 (extract ShareImportManager) which deletes BackgroundShareTransferManager's upload code.\n\nKEY FILES:\n- apps/ios/Vault/Core/Sharing/ShareUploadManager.swift (find Data(contentsOf:) calls)\n- apps/ios/Vault/Core/Sharing/CloudKitSharingManager.swift (uploadChunksFromFile already exists)","status":"closed","priority":2,"issue_type":"task","owner":"r@turek.co","created_at":"2026-02-21T11:37:01.545525-08:00","created_by":"ehmo","updated_at":"2026-02-21T12:39:15.823344-08:00","closed_at":"2026-02-21T12:39:15.823344-08:00","close_reason":"Already resolved: BackgroundShareTransferManager replaced by ShareImportManager, all upload paths (ShareUploadManager, ShareSyncManager) already use file-based streaming"}
{"id":"VAULT-9hn","title":"Remove double encryption layer in share upload","description":"Files are encrypted per-file with shareKey at BackgroundShareTransferManager:90, then the entire JSON blob is encrypted again with the same shareKey at CloudKitSharingManager:131. The outer encryption adds latency and ~28 bytes overhead per AES-GCM seal. Remove the outer encryption or the per-file encryption ‚Äî not both.","status":"closed","priority":2,"issue_type":"bug","owner":"r@turek.co","created_at":"2026-02-01T16:40:28.481677-08:00","created_by":"ehmo","updated_at":"2026-02-01T16:43:54.002105-08:00","closed_at":"2026-02-01T16:43:54.002105-08:00","close_reason":"Removed outer AES-GCM encryption in uploadSharedVault and syncSharedVault (files already individually encrypted). Bumped manifest version to 2. Download paths handle both v1 (outer decrypt) and v2 (raw passthrough) for backward compat."}
{"id":"VAULT-9pf","title":"[Test-8] Create test-isolated VaultStorage with custom temp directory","description":"VaultStorage tests use .shared singleton, reading/writing the real Documents directory. Tests interfere with each other and state persists across runs.\n\nPLAN:\n1. Add internal init(documentsURL: URL, blobSize: Int) to VaultStorage for test use\n   - Or create a VaultStorageTestFactory that returns an instance with a temp directory\n2. Update VaultStorageIntegrationTests to create isolated storage per test\n3. tearDown cleans up temp directory\n4. Use smaller blob size (e.g., 1MB) for faster tests and easier expansion testing\n5. Keep .shared as the production singleton (unchanged)\n\nBENEFITS:\n- Tests become hermetic (no cross-test contamination)\n- Smaller blob size enables expansion/compaction testing without 50MB+ test data\n- Tests can run in parallel\n\nNOTE: VaultStorageProtocol exists but is for DI at the consumer level. This is about making VaultStorage itself testable.\n\nFile: apps/ios/Vault/Core/Storage/VaultStorage.swift (add internal init)\nFile: apps/ios/VaultTests/VaultStorageIntegrationTests.swift (use isolated storage)","status":"open","priority":2,"issue_type":"task","owner":"r@turek.co","created_at":"2026-02-23T13:31:33.513144-08:00","created_by":"ehmo","updated_at":"2026-02-23T13:31:33.513144-08:00"}
{"id":"VAULT-9pw","title":"Switch ThumbnailCache to NSCache for memory pressure handling","description":"PERFORMANCE #36: ThumbnailCache uses a plain dictionary with no eviction policy. No didReceiveMemoryWarning handler. On older devices (2-3 GB RAM), thousands of thumbnails can exhaust memory.\n\nFIX: Replace Dictionary-based cache with NSCache. Set totalCostLimit based on thumbnail sizes. NSCache auto-evicts under memory pressure.\n\nEFFORT: ~2 hours\n\nKEY FILES:\n- apps/ios/Vault/Core/Cache/ThumbnailCache.swift","status":"closed","priority":2,"issue_type":"task","owner":"r@turek.co","created_at":"2026-02-21T11:38:38.936122-08:00","created_by":"ehmo","updated_at":"2026-02-21T12:42:12.481007-08:00","closed_at":"2026-02-21T12:42:12.481007-08:00","close_reason":"Already uses NSCache with countLimit=500 and totalCostLimit (50MB/30MB). Auto-evicts under memory pressure."}
{"id":"VAULT-9qr","title":"WS7: Benefit-led copy rewrites","status":"closed","priority":2,"issue_type":"task","owner":"r@turek.co","created_at":"2026-02-08T23:13:48.913761-08:00","created_by":"ehmo","updated_at":"2026-02-08T23:14:32.864301-08:00","closed_at":"2026-02-08T23:14:32.864301-08:00","close_reason":"Closed"}
{"id":"VAULT-9tu","title":"WS2: Affordance + batch select mode","status":"closed","priority":1,"issue_type":"feature","owner":"r@turek.co","created_at":"2026-02-08T23:05:16.802169-08:00","created_by":"ehmo","updated_at":"2026-02-08T23:07:30.66979-08:00","closed_at":"2026-02-08T23:07:30.66979-08:00","close_reason":"Closed"}
{"id":"VAULT-aeh","title":"[Arch-10] Add NSFileCoordinator for share extension / main app blob coordination","description":"Share Extension and main app share the blob via app group. Extension stages encrypted files to shared directory, main app ingests on unlock. Both could theoretically access shared directory simultaneously.\n\nPLAN:\n1. Add NSFileCoordinator to StagedImportManager for writing staged files\n2. Add NSFileCoordinator to ImportIngestor for reading staged files\n3. Use coordinateReadingItem/coordinateWritingItem with .forMerging intent\n4. Wrap staging directory access with file coordinator\n5. Handle NSFilePresenter registration for the shared staging directory\n\nNOTE: NSFileCoordinator is Apple's blessed pattern for inter-process file coordination. More robust than atomic rename for complex scenarios.\n\nFiles: StagedImportManager.swift, ImportIngestor.swift (or equivalent ingestion code), ShareExtension/ShareViewController.swift\nTest: Verify no races under concurrent extension/app access.","status":"open","priority":3,"issue_type":"task","owner":"r@turek.co","created_at":"2026-02-23T12:04:01.401528-08:00","created_by":"ehmo","updated_at":"2026-02-23T12:04:01.401528-08:00"}
{"id":"VAULT-ak1","title":"Bug: checkSharedVaultStatus inflates open count on every view appearance","description":"VaultView+SharedVault.swift:91-102: open count incremented every time checkSharedVaultStatus() runs ‚Äî triggered by loadVault() in .task and onChange(of: showingSettings). Navigating away/back burns through maxOpens. Fix: add a flag reset on vault lock, increment open count only once per unlock session.","status":"closed","priority":1,"issue_type":"bug","owner":"r@turek.co","created_at":"2026-02-17T20:37:03.50685-08:00","created_by":"ehmo","updated_at":"2026-02-17T20:53:35.989915-08:00","closed_at":"2026-02-17T20:53:35.989915-08:00","close_reason":"Closed"}
{"id":"VAULT-akj","title":"Batch storeFiles() method mirroring deleteFiles","description":"storeFile loads/saves index per call. During 20-photo import = 40 crypto ops + 40 disk writes. Add storeFiles(batch:) that loads index once, appends all, saves once.","status":"closed","priority":2,"issue_type":"task","owner":"r@turek.co","created_at":"2026-02-11T22:01:15.440696-08:00","created_by":"ehmo","updated_at":"2026-02-11T22:28:19.159831-08:00","closed_at":"2026-02-11T22:28:19.159831-08:00","close_reason":"Closed"}
{"id":"VAULT-axv","title":"Add interactiveDismissDisabled to multi-step sheet flows","description":"ChangePatternView, RecoveryPhraseInputView can be accidentally dismissed by swiping down mid-flow. Add .interactiveDismissDisabled() when user is partway through multi-step process.","status":"closed","priority":2,"issue_type":"task","owner":"r@turek.co","created_at":"2026-02-01T15:10:20.675958-08:00","created_by":"ehmo","updated_at":"2026-02-01T15:19:39.355315-08:00","closed_at":"2026-02-01T15:19:39.355315-08:00","close_reason":"Added .interactiveDismissDisabled() to ChangePatternView, CustomRecoveryPhraseInputView, and RecoveryPhraseInputView sheets. All have explicit Cancel/Done buttons, preventing accidental swipe-dismiss during multi-step flows."}
{"id":"VAULT-b9a","title":"[CQ-9] Remove dead code in PatternSetupView","description":"PatternSetupView.swift has two pieces of dead code:\n\n1. Lines 323-329: Redundant if/else where both branches do the same thing:\n   if useCustomPhrase {\n       onComplete()\n   } else {\n       onComplete()\n   }\n   FIX: Replace with just onComplete()\n\n2. Lines 445-466: saveCustomRecoveryPhrase() method is never called (unreferenced).\n   FIX: Delete the entire method.\n\nFile: apps/ios/Vault/Features/Onboarding/PatternSetupView.swift\nTEST: Build should succeed. Verify no references to saveCustomRecoveryPhrase exist.","status":"open","priority":4,"issue_type":"task","owner":"r@turek.co","created_at":"2026-02-23T13:25:03.343995-08:00","created_by":"ehmo","updated_at":"2026-02-23T13:25:03.343995-08:00"}
{"id":"VAULT-bad","title":"Security: Streaming decrypt XOR nonce computed but discarded ‚Äî no chunk ordering enforcement","description":"CryptoEngine.swift:331-334 (also 377-379, 486-488): XOR-derived nonce is computed and validated but then discarded. sealedBox nonce comes from combined data. AES-GCM auth ensures no tampering but doesn't prevent chunk reordering. Fix: after decryption, verify sealedBox.nonce matches expected XOR nonce; throw tamperedChunk if mismatch. Pair with chunk-swap test.","status":"closed","priority":1,"issue_type":"bug","owner":"r@turek.co","created_at":"2026-02-17T20:37:16.40399-08:00","created_by":"ehmo","updated_at":"2026-02-17T20:53:36.007137-08:00","closed_at":"2026-02-17T20:53:36.007137-08:00","close_reason":"Closed"}
{"id":"VAULT-bas","title":"Reduce artificial unlock delay floor","status":"closed","priority":3,"issue_type":"task","created_at":"2026-01-29T14:08:41.076025-08:00","created_by":"ehmo","updated_at":"2026-01-29T14:10:23.066656-08:00","closed_at":"2026-01-29T14:10:23.066656-08:00","close_reason":"Closed"}
{"id":"VAULT-bcm","title":"[Test-10] Implement ErrorHandlingTests from TEST_PLAN Phase 2","description":"TEST_PLAN.md Phase 2 defines ErrorHandlingTests that verify crypto/storage errors surface correctly to users. Zero implementation exists.\n\nTESTS TO WRITE (new file: VaultTests/ErrorHandlingTests.swift):\n1. testCryptoErrorSurfacesInUI - encrypt/decrypt failure shows user-facing error message\n2. testStorageErrorSurfacesInUI - VaultStorageError types produce correct user-facing descriptions\n3. testNetworkErrorDuringShareShowsMessage - CloudKit failure shows 'check connection' message\n4. testIndexCorruptionShowsRecoveryOption - indexDecryptionFailed shows appropriate guidance\n5. testDiskFullErrorDuringImport - write failure shows space-related message\n6. testErrorMessagesDontLeakInternalState - verify error descriptions don't include file paths, keys, or offsets\n\nALSO: Verify all error enum errorDescription properties are complete and user-friendly:\n- CryptoError (6 cases)\n- VaultStorageError (9 cases)\n- CloudKitSharingError (10 cases)\n\nFile: all Error enums across the codebase\nNew: apps/ios/VaultTests/ErrorHandlingTests.swift","status":"open","priority":2,"issue_type":"task","owner":"r@turek.co","created_at":"2026-02-23T13:31:46.428833-08:00","created_by":"ehmo","updated_at":"2026-02-23T13:31:46.428833-08:00"}
{"id":"VAULT-bdu","title":"[Perf-6] Add FileHandle cache to compactBlobs()","description":"compactBlobs() opens/closes read+write FileHandles per file. For N files in same blob = 2N handle operations. Pattern already exists in storeFiles (allocateBlobSpace with handleCache).\n\nFIX:\n1. Add readHandleCache: [URL: FileHandle] and writeHandleCache: [URL: FileHandle] before the loop\n2. Look up handles by blob URL before opening new ones\n3. Close all cached handles in defer block after loop\n4. Replace lines 1216-1224 (read) and 1248-1253 (write) with cached versions\n\nFile: apps/ios/Vault/Core/Storage/VaultStorage.swift:1213-1253\nTEST: Verify compaction still produces correct output. Measure handle open/close reduction.","status":"open","priority":3,"issue_type":"task","owner":"r@turek.co","created_at":"2026-02-23T13:38:14.88391-08:00","created_by":"ehmo","updated_at":"2026-02-23T13:38:14.88391-08:00"}
{"id":"VAULT-bez","title":"Remove try? on CloudKit operations + establish error logging policy","description":"CODE QUALITY #20: Inconsistent error handling across CloudKit operations. Some use Embrace capture, some Logger.error, some try? (silent swallow). \n\nIMPLEMENTATION:\nPhase 1 (immediate): Remove all try? on CloudKit operations\n- CloudKitSharingManager: orphan deletion (lines 306-309), deleteChunks (955-968)\n- Convert to do/catch with Logger.error minimum\n- Add Embrace capture for data-loss scenarios\n\nPhase 2 (follow-up): Establish 3-tier policy:\n- Tier 1 (Embrace): data loss, security failures, CloudKit save/delete failures\n- Tier 2 (Logger.error): recoverable failures, degraded functionality\n- Tier 3 (silent): expected states (no network, user cancellation, empty results)\n- Document in AGENTS.md\n\nKEY FILES: All files using try? on CloudKit/network operations (grep for 'try?' in Core/Sharing/ and Core/Storage/iCloudBackupManager.swift)","status":"closed","priority":2,"issue_type":"task","owner":"r@turek.co","created_at":"2026-02-21T11:37:11.665398-08:00","created_by":"ehmo","updated_at":"2026-02-21T12:40:20.693837-08:00","closed_at":"2026-02-21T12:40:20.693837-08:00","close_reason":"Replaced last try? on CK ops, documented 3-tier error logging policy in AGENTS.md"}
{"id":"VAULT-bi2","title":"[Arch-7] Make VaultFileEntry.isDeleted mutable to eliminate reconstruction boilerplate","description":"VaultFileEntry is fully immutable (all let properties). Deleting a file requires reconstructing the entire struct with all 12 fields just to flip isDeleted. This boilerplate appears in VaultStorage.swift:774-787 (single delete) and 824-837 (batch delete).\n\nFIX: Change 'let isDeleted: Bool' to 'var isDeleted: Bool' in VaultIndexTypes.swift:88.\nThen replace the reconstruction blocks with: index.files[entryIndex].isDeleted = true\n\nALSO: Clear thumbnailData on delete to free memory: index.files[entryIndex].thumbnailData = nil (make thumbnailData a var too)\n\nFiles: VaultIndexTypes.swift:88, VaultStorage.swift:774-787, VaultStorage.swift:824-837\nTest: Existing delete tests should pass unchanged.","status":"open","priority":3,"issue_type":"task","owner":"r@turek.co","created_at":"2026-02-23T12:03:33.509279-08:00","created_by":"ehmo","updated_at":"2026-02-23T12:03:33.509279-08:00"}
{"id":"VAULT-bmq","title":"Tests: CloudKitSharingClient mock + ShareSyncManager tests","description":"CloudKitSharingManager and ShareSyncManager have zero unit tests. The non-CloudKit logic (sync state machine, job transitions, conflict resolution) can be tested without iCloud. Extract CloudKitSharingClient protocol, create a mock, test ShareSyncManager orchestration in isolation. CloudKitSharingManager itself stays as a thin adapter.","status":"closed","priority":2,"issue_type":"task","owner":"r@turek.co","created_at":"2026-02-17T20:38:02.722043-08:00","created_by":"ehmo","updated_at":"2026-02-17T22:42:10.040629-08:00","closed_at":"2026-02-17T22:42:10.040629-08:00","close_reason":"Closed","dependencies":[{"issue_id":"VAULT-bmq","depends_on_id":"VAULT-esf","type":"blocks","created_at":"2026-02-17T20:38:44.858855-08:00","created_by":"ehmo"}]}
{"id":"VAULT-boo","title":"[Perf-5] Cache decrypted master key in VaultIndexManager","description":"Master key is re-derived via CryptoEngine.decrypt(encryptedMasterKey, vaultKey) on every retrieveFile/deleteFile/storeFile call. While index is cached, master key is not.\n\nFIX:\n1. Add to VaultIndexManager:\n   - private var cachedMasterKey: Data?\n   - private var cachedMasterKeyFingerprint: String?\n2. In getMasterKey(): check cache first, return if fingerprint matches\n3. On cache hit: return cachedMasterKey directly (skip AES-GCM decrypt)\n4. Invalidate in invalidateCache() and invalidateCache(for:) ‚Äî same as index cache\n5. Master key stays in memory only while vault unlocked (cleared on lock via invalidateCache)\n\nSECURITY NOTE: This is safe because the master key is already in memory via AppState.currentVaultKey -\u003e index -\u003e encryptedMasterKey. Caching the decrypted form eliminates redundant crypto but doesn't change the threat model.\n\nFile: apps/ios/Vault/Core/Storage/VaultIndexManager.swift:192-206 (getMasterKey)\nFile: apps/ios/Vault/Core/Storage/VaultIndexManager.swift:210-227 (invalidateCache)\nTEST: Verify master key cache is used on repeated calls. Verify invalidation on lock.","status":"open","priority":2,"issue_type":"task","owner":"r@turek.co","created_at":"2026-02-23T13:38:09.330249-08:00","created_by":"ehmo","updated_at":"2026-02-23T13:38:09.330249-08:00"}
{"id":"VAULT-bul","title":"Add performance benchmark tests for critical paths","description":"TEST #29: Zero XCTest measure blocks. No baselines for performance-critical operations.\n\nCreate PerformanceBenchmarkTests.swift:\n- Benchmark: PBKDF2 600K iterations (must be 0.3-2.0s on target devices)\n- Benchmark: VCSE streaming encrypt at 1MB, 10MB, 50MB\n- Benchmark: VCSE streaming decrypt at same sizes\n- Benchmark: SVDF build for 10-file, 100-file, 1000-file vault\n- Benchmark: Thumbnail batch decryption (100 thumbnails)\n- Benchmark: VaultIndex JSON serialization at 100, 1000, 10000 entries\n- Benchmark: SecureDelete 3-pass at 1MB, 10MB\n\nUse XCTest measure {} blocks with baselines. Set performance test baseline in scheme.\n\nPBKDF2 timing is security-relevant: too fast = weak protection, too slow = bad UX.\n\nKEY FILES: New file in VaultTests/","status":"closed","priority":2,"issue_type":"task","owner":"r@turek.co","created_at":"2026-02-21T11:38:12.231141-08:00","created_by":"ehmo","updated_at":"2026-02-21T12:51:24.215534-08:00","closed_at":"2026-02-21T12:51:24.215534-08:00","close_reason":"Closed"}
{"id":"VAULT-bws","title":"Gate blob compaction on idle state (no active background ops)","description":"PERFORMANCE #33: compactBlobs() securely overwrites and deletes old blob files. If background share upload/sync is reading from a blob being compacted, it reads corrupted data. indexLock doesn't protect raw blob reads.\n\nIMPLEMENTATION:\n1. Before compaction, check:\n   - ShareUploadManager.shared.hasActiveJobs == false\n   - ShareSyncManager.shared.isSyncing == false  \n   - iCloudBackupManager.shared.isBackingUp == false\n2. If any active, defer compaction (queue for later or show 'please wait' in UI)\n3. Consider: add a compactionLock that background readers acquire before reading blob data\n\nKEY FILES:\n- apps/ios/Vault/Core/Storage/VaultStorage.swift (compactBlobs method)","status":"closed","priority":2,"issue_type":"task","owner":"r@turek.co","created_at":"2026-02-21T11:38:35.427371-08:00","created_by":"ehmo","updated_at":"2026-02-21T12:41:53.769675-08:00","closed_at":"2026-02-21T12:41:53.769675-08:00","close_reason":"compactBlobs is dead code (defined but never called). No callers exist, so no gating needed. When the feature is activated, add idle checks at the call site."}
{"id":"VAULT-bzt","title":"Move listFiles + thumbnail decrypt off Main Actor","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-29T14:08:40.684842-08:00","created_by":"ehmo","updated_at":"2026-01-29T14:09:43.214355-08:00","closed_at":"2026-01-29T14:09:43.214355-08:00","close_reason":"Closed"}
{"id":"VAULT-c0h","title":"[Arch-5] Create SymmetricKeyData protocol for type-safe key passing","description":"Despite VaultKey/MasterKey/ShareKey wrappers in KeyTypes.swift, CryptoEngine.encrypt/decrypt take raw Data. getMasterKey returns Data. isDuressKey takes Data. Wrappers are only used at AppState boundary with .rawBytes called immediately.\n\nPLAN:\n1. Create protocol SymmetricKeyData with rawBytes: Data requirement\n2. Conform VaultKey, MasterKey, ShareKey to it\n3. Change CryptoEngine.encrypt/decrypt to accept 'some SymmetricKeyData' for key parameter\n4. Change VaultIndexManager.getMasterKey to return MasterKey instead of Data\n5. Change DuressHandler.isDuressKey/setAsDuressVault to accept VaultKey\n6. Change KeyDerivation.deriveKey to return VaultKey\n7. Gradually migrate callers to pass typed keys instead of .rawBytes\n\nFiles: KeyTypes.swift (protocol), CryptoEngine.swift (parameter types), VaultIndexManager.swift, DuressHandler.swift, KeyDerivation.swift","status":"open","priority":2,"issue_type":"task","owner":"r@turek.co","created_at":"2026-02-23T12:03:19.360314-08:00","created_by":"ehmo","updated_at":"2026-02-23T12:03:19.360314-08:00"}
{"id":"VAULT-c4q","title":"[Test-4] Add blob expansion and compaction tests","description":"VaultStorage blob expansion (when primary blob is full) and compactBlobs (reclaiming deleted space) have ZERO test coverage.\n\nTESTS TO WRITE (add to VaultTests/VaultStorageIntegrationTests.swift or new file):\n1. testStoreFileFillsPrimaryBlobCreatesExpansion - store files until primary blob full, verify expansion blob created\n2. testRetrieveFileFromExpansionBlob - after expansion, retrieve file from secondary blob\n3. testCompactBlobsReclaimsDeletedSpace - store files, delete \u003e30%, compact, verify used space decreased\n4. testCompactBlobsPreservesAllLiveFiles - after compaction, all non-deleted files still retrievable with correct content\n5. testCompactBlobsWithFilesExceedingSingleBlob - live files need multiple blobs after compaction\n6. testCompactBlobsWithNoDeletions - compact with no deleted files is a no-op (or preserves everything)\n7. testExpansionBlobIsRandomFilled - verify expansion blob content is not zeroed\n\nNOTE: May need test-only init for VaultStorage with custom blob size (e.g., 1MB instead of 50MB) to make expansion testable without storing 50MB of data.\n\nFile: apps/ios/Vault/Core/Storage/VaultStorage.swift:1176-1315 (source)\nFile: apps/ios/VaultTests/VaultStorageIntegrationTests.swift (add tests)","status":"open","priority":2,"issue_type":"task","owner":"r@turek.co","created_at":"2026-02-23T13:30:55.678107-08:00","created_by":"ehmo","updated_at":"2026-02-23T13:30:55.678107-08:00"}
{"id":"VAULT-c7n","title":"Share vault via link (universal links + deep link handling)","description":"Add ability to share vaults via copyable links instead of just phrases. Link format: https://vaultaire.app/s#[encoded-phrase]. BIP39 word indices packed into custom base58-like encoding (no ambiguous chars). Fragment-only so phrase never hits server. Infrastructure: AASA file, static landing page, Associated Domains entitlement, onOpenURL handler, SharedVaultInviteView, ShareLinkGenerator, Copy Link + share sheet button on share screen. One-time use (claimed flag). Revoked links show error screen. Deep link bypasses pattern screen into shared vault onboarding.","status":"closed","priority":1,"issue_type":"feature","owner":"r@turek.co","created_at":"2026-02-10T13:41:30.359417-08:00","created_by":"ehmo","updated_at":"2026-02-21T13:02:01.480012-08:00","closed_at":"2026-02-21T13:02:01.480012-08:00","close_reason":"Fully implemented: ShareLinkEncoder, DeepLinkHandler, AASA, landing page, Associated Domains, onOpenURL, SharedVaultInviteView, share buttons, comprehensive tests"}
{"id":"VAULT-cci","title":"[Perf-2] Batch importSVDFDelta and importLegacyFull store/delete operations","description":"N+1: Both importSVDFDelta (lines 206-246) and importLegacyFull (lines 290-321) in VaultView+SharedVault.swift call individual deleteFile/storeFile in loops. Each triggers full index load/save. For K removed + M new = (K+M) index cycles.\n\nFIX for importSVDFDelta:\n1. Collect removed IDs into Set\u003cUUID\u003e, call deleteFiles(ids:with:) once\n2. Collect new files into [FileToStore], call storeFiles(_:with:) once\n3. Total: 2 index saves instead of K+M\n\nFIX for importLegacyFull:\n1. Same pattern: collect then batch\n\nBatch APIs exist: VaultStorage.deleteFiles(ids:with:) at line 794, VaultStorage.storeFiles(_:with:) at line 508.\n\nFiles: apps/ios/Vault/Features/VaultViewer/VaultView+SharedVault.swift:206-246, 290-321\nTEST: Verify shared vault import works for both delta and full import paths. Verify progress callbacks still fire.","status":"open","priority":2,"issue_type":"task","owner":"r@turek.co","created_at":"2026-02-23T13:37:48.724399-08:00","created_by":"ehmo","updated_at":"2026-02-23T13:37:48.724399-08:00"}
{"id":"VAULT-cp2","title":"[Perf-8] Combine performSync() index load/saves into single cycle","description":"ShareSyncManager.performSync() (lines 492-522) has two separate load/modify/save blocks after sync: one for consumed share removal, one for share record updates. Could be a single load -\u003e modify both -\u003e save.\n\nFIX:\n1. Merge the two blocks at lines 492-522 into:\n   var updatedIndex = try storage.loadIndex(with: vaultKey)\n   // Remove consumed shares\n   updatedIndex.activeShares?.removeAll { consumedIds.contains($0.id) }\n   // Update share records\n   for update in shareUpdates { ... }\n   // Save once\n   try storage.saveIndex(updatedIndex, with: vaultKey)\n2. Also remove redundant .filter { !$0.isDeleted }.count calls used only for debug logging\n\nFile: apps/ios/Vault/Core/Sharing/ShareSyncManager.swift:492-522\nTEST: Verify sync still updates index correctly after combined load/save.","status":"open","priority":3,"issue_type":"task","owner":"r@turek.co","created_at":"2026-02-23T13:38:35.430654-08:00","created_by":"ehmo","updated_at":"2026-02-23T13:38:35.430654-08:00"}
{"id":"VAULT-cxk","title":"Refactor: Replace VaultStorage print() with Logger (os.log)","description":"VaultStorage.swift has 50+ #if DEBUG print(...) calls with emoji prefixes. All other files use Logger (os.log). Replace with: private let logger = Logger(subsystem: Bundle.main.bundleIdentifier\\!, category: 'storage'). Enables production log-level filtering, Instruments integration, and category filtering.","status":"closed","priority":3,"issue_type":"task","owner":"r@turek.co","created_at":"2026-02-17T20:38:13.270455-08:00","created_by":"ehmo","updated_at":"2026-02-17T21:33:48.47654-08:00","closed_at":"2026-02-17T21:33:48.47654-08:00","close_reason":"Closed"}
{"id":"VAULT-czs","title":"Eliminate redundant index+key derivation in share upload loop","description":"BackgroundShareTransferManager:89 calls retrieveFile(id:with:) per file, which internally calls loadIndex()+getMasterKey() each time. The index and masterKey are already available at lines 81-82. Add a VaultStorage method to retrieve file content with pre-loaded index and masterKey.","status":"closed","priority":1,"issue_type":"bug","owner":"r@turek.co","created_at":"2026-02-01T16:40:23.51007-08:00","created_by":"ehmo","updated_at":"2026-02-01T16:41:19.426369-08:00","closed_at":"2026-02-01T16:41:19.426369-08:00","close_reason":"Added retrieveFileContent(entry:index:masterKey:) to VaultStorage. Upload loop now reuses pre-loaded index and masterKey instead of re-deriving per file. Eliminates N redundant loadIndex+PBKDF2 calls."}
{"id":"VAULT-d1x","title":"Add retry + error tracking for orphan chunk deletion","description":"CODE QUALITY #13: Orphan CloudKit chunks deleted with try? (silent failure). Chunks accumulate in public DB over time.\n\nIMPLEMENTATION:\n1. In CloudKitSharingManager.swift lines 306-309 (orphan deletion after SVDF shrink):\n   - Replace try? with proper retry using new deleteWithRetry (from CKDatabase+Retry)\n   - On failure after retries: log to Embrace + persist orphan recordIDs to disk\n2. In deleteChunks (lines 955-968):\n   - Same treatment: retry per-chunk deletion\n   - Log failures instead of swallowing\n3. Add periodic cleanup: on app launch, check for persisted orphan IDs, attempt deletion\n4. Store orphan IDs in: Documents/orphan_chunks.json (simple JSON array of record name strings)\n\nKEY FILES:\n- apps/ios/Vault/Core/Sharing/CloudKitSharingManager.swift (lines 306-309, 955-968)\n\nDEPENDS ON: VAULT-xxx (CKDatabase+Retry extension) for shared retry logic.\n\nTESTS NEEDED:\n- Unit test: orphan IDs persisted on deletion failure\n- Unit test: cleanup job processes persisted orphans","status":"closed","priority":2,"issue_type":"task","owner":"r@turek.co","created_at":"2026-02-21T11:36:47.087206-08:00","created_by":"ehmo","updated_at":"2026-02-21T12:38:25.282562-08:00","closed_at":"2026-02-21T12:38:25.282562-08:00","close_reason":"Added deleteWithRetry to orphan deletion, orphan persistence to JSON, cleanup on app launch","dependencies":[{"issue_id":"VAULT-d1x","depends_on_id":"VAULT-5vy","type":"blocks","created_at":"2026-02-21T11:38:44.2901-08:00","created_by":"ehmo"}]}
{"id":"VAULT-d3u","title":"Add unit tests for savePattern error paths via protocol-based mocking","description":"PatternSetupView.savePattern() and saveCustomRecoveryPhrase() now show error alerts on failure, but the error paths cannot be unit tested without protocol-based mocking of VaultStorage, KeyDerivation, and RecoveryPhraseManager. Create protocols for these dependencies, inject them into PatternSetupView, and write tests for: key derivation failure, vault save failure, recovery phrase save failure, and duplicate pattern detection.","status":"closed","priority":3,"issue_type":"task","owner":"r@turek.co","created_at":"2026-02-13T15:21:10.166643-08:00","created_by":"ehmo","updated_at":"2026-02-13T16:55:07.212839-08:00","closed_at":"2026-02-13T16:55:07.212839-08:00","close_reason":"Implemented VaultStorageIntegrationTests (10 tests) and PatternSetupCoordinator with PatternSetupCoordinatorTests (6 tests). All 165 tests pass."}
{"id":"VAULT-d6k","title":"Refactor: VaultKey/MasterKey/ShareKey newtypes ‚Äî prevent wrong-key misuse","description":"All key types are untyped Data, passed through dozens of function signatures. A wrong key compiles silently. Introduce VaultKey, MasterKey, ShareKey as struct newtypes: struct VaultKey { let rawBytes: Data }. Breaking at all call sites but compiler-enforced. VaultStorage, ShareSyncManager, ShareUploadManager, BackgroundShareTransferManager, ImportIngestor all affected.","status":"closed","priority":1,"issue_type":"task","owner":"r@turek.co","created_at":"2026-02-17T20:36:42.120811-08:00","created_by":"ehmo","updated_at":"2026-02-17T22:08:30.272674-08:00","closed_at":"2026-02-17T22:08:30.272674-08:00","close_reason":"Implemented and tested in commit 07af505"}
{"id":"VAULT-dc2","title":"Auto re-backup after pattern change + warn user","description":"ARCHITECTURE #10: iCloud backups encrypted with vault key (pattern-derived). Pattern change = new key = old backup unrestorable.\n\nIMPLEMENTATION:\n1. In ChangePatternView, after successful pattern change:\n   - Show warning: 'Your iCloud backup will be updated with your new pattern'\n   - Trigger iCloudBackupManager.shared.scheduleBackup() automatically\n2. Add a note in the change-pattern confirmation dialog about backup implications\n3. Consider: if no backup exists, skip the warning\n\nKEY FILES:\n- apps/ios/Vault/Features/Settings/ChangePatternView.swift (add warning + trigger)\n- apps/ios/Vault/Core/Storage/iCloudBackupManager.swift (scheduleBackup call)\n\nTESTS NEEDED:\n- Unit test: backup scheduled after pattern change\n- Maestro flow: change pattern shows backup warning","status":"closed","priority":2,"issue_type":"task","owner":"r@turek.co","created_at":"2026-02-21T11:36:27.365191-08:00","created_by":"ehmo","updated_at":"2026-02-21T12:33:12.701119-08:00","closed_at":"2026-02-21T12:33:12.701119-08:00","close_reason":"Added backup trigger after pattern change + backup warning in confirmation dialog"}
{"id":"VAULT-dkt","title":"Unit tests for PatternValidator, PatternSerializer, KeyDerivation","description":"Zero tests for security-critical pure-logic modules. Write comprehensive tests: pattern validation rules, serialization determinism, key fingerprint, normalization.","status":"closed","priority":1,"issue_type":"task","owner":"r@turek.co","created_at":"2026-02-11T22:00:59.081126-08:00","created_by":"ehmo","updated_at":"2026-02-11T22:20:24.369378-08:00","closed_at":"2026-02-11T22:20:24.369378-08:00","close_reason":"136 tests passing: PatternValidator (20), PatternSerializer (29), KeyDerivation (11), ShareLinkEncoder (20), RecoveryPhraseGenerator (19). Also fixed analyzePattern crash on empty patterns."}
{"id":"VAULT-dr2","title":"Fix share phrase logging security vulnerability","description":"ARCHITECTURE #3: CloudKitSharingManager.swift logs the share phrase (sole secret protecting shared vaults) at ERROR level with privacy: .public.\n\nVULNERABLE LINES in CloudKitSharingManager.swift:\n- Line 369: Self.logger.error(\"DOWNLOAD DEBUG Phrase: \\\\(phrase, privacy: .public)\")\n- Lines 181-186, 211-213, 223, 228: Similar debug logging with .public privacy\n\nThe share phrase appears in: device console logs, potentially Embrace crash reports, Unified Logging system.\n\nFIX:\n1. Wrap all sensitive-value logging in #if DEBUG\n2. In production, log only non-sensitive identifiers (shareVaultId, chunk counts, progress)\n3. For any remaining production logging of sensitive values, use privacy: .private\n4. Audit ALL Logger calls in CloudKitSharingManager.swift for sensitive data leakage\n\nFILE: apps/ios/Vault/Core/Sharing/CloudKitSharingManager.swift","status":"closed","priority":0,"issue_type":"bug","owner":"r@turek.co","created_at":"2026-02-21T11:35:38.617125-08:00","created_by":"ehmo","updated_at":"2026-02-21T11:44:34.85543-08:00","closed_at":"2026-02-21T11:44:34.85543-08:00","close_reason":"Removed phrase from all logs, changed privacy to .private, downgraded debug messages. Build passed."}
{"id":"VAULT-dt5","title":"[Test-6] Add StoreKit purchase/revocation/grace-period tests","description":"SubscriptionManager tests only test mock client boundaries. Real StoreKit flows are untested. Products.storekit config already exists.\n\nTESTS TO WRITE (new file: VaultTests/StoreKitIntegrationTests.swift):\n1. testPurchaseMonthlySubscription - SKTestSession.buyProduct, verify isPremium becomes true\n2. testPurchaseCancellation - begin purchase then cancel, verify still free tier\n3. testPurchasePending - transaction stays pending, verify not premium\n4. testSubscriptionRevocation - purchase then revoke via SKTestSession, verify isPremium becomes false\n5. testSubscriptionExpiration - purchase, advance time past expiration, verify downgrade\n6. testGracePeriodBehavior - expired but in billing retry, verify premium maintained\n7. testRestorePurchases - purchase on another device, restore, verify premium\n8. testLifetimePurchase - purchase lifetime product, verify premium, verify no expiration\n9. testUpgradeFromMonthlyToYearly - verify transition handled\n\nSETUP: Use SKTestSession in setUp(), reset in tearDown(). Use Products.storekit configuration.\n\nFile: apps/ios/Vault/Core/Billing/SubscriptionManager.swift (source)\nFile: apps/ios/Products.storekit (config)\nNew: apps/ios/VaultTests/StoreKitIntegrationTests.swift","status":"open","priority":2,"issue_type":"task","owner":"r@turek.co","created_at":"2026-02-23T13:31:12.920709-08:00","created_by":"ehmo","updated_at":"2026-02-23T13:31:12.920709-08:00"}
{"id":"VAULT-dwo","title":"Tests: Share round-trip integration test ‚Äî owner stores, recipient decrypts, verify bytes","description":"Maestro share flows test UI only, not data correctness. Write integration test: share a known file with a known phrase (two VaultStorage instances, different vault keys), import as recipient, verify decrypted bytes match original. This is the most valuable missing integration test.","status":"closed","priority":2,"issue_type":"task","owner":"r@turek.co","created_at":"2026-02-17T20:38:13.145147-08:00","created_by":"ehmo","updated_at":"2026-02-17T22:42:10.058414-08:00","closed_at":"2026-02-17T22:42:10.058414-08:00","close_reason":"Closed"}
{"id":"VAULT-egh","title":"Add error feedback when pattern confirmation fails","description":"PatternSetupView.swift:374-379 silently resets when patterns don't match during onboarding confirm step. No text error, no shake, no feedback. Compare to PatternLockView which does show error message.","status":"closed","priority":2,"issue_type":"bug","owner":"r@turek.co","created_at":"2026-02-01T15:10:19.667722-08:00","created_by":"ehmo","updated_at":"2026-02-01T15:18:59.251148-08:00","closed_at":"2026-02-01T15:18:59.251148-08:00","close_reason":"Added visible error message ('Patterns don't match. Try again.') with icon when pattern confirmation fails in PatternSetupView. Auto-clears after 2.5s. Pairs with existing haptic error feedback."}
{"id":"VAULT-esf","title":"Refactor: Protocol + environment injection for VaultStorage, CloudKitSharingManager, SubscriptionManager","description":"~17 singletons make testing and lifecycle management difficult. First priority: define protocols for VaultStorage (VaultStorageProtocol), CloudKitSharingManager (CloudKitSharingClient), SubscriptionManager (SubscriptionManagerProtocol). Inject via SwiftUI Environment or constructor. Enables mocking in tests. High effort, high payoff.","status":"closed","priority":2,"issue_type":"task","owner":"r@turek.co","created_at":"2026-02-17T20:37:51.16305-08:00","created_by":"ehmo","updated_at":"2026-02-17T22:28:57.140175-08:00","closed_at":"2026-02-17T22:28:57.140175-08:00","close_reason":"Protocols + constructor injection in commit 896cfc5"}
{"id":"VAULT-ex5","title":"Deepen shallow Maestro E2E flows","description":"TEST #30: Several Maestro flows barely test anything - just navigate to a screen without assertions.\n\nFLOWS TO DEEPEN:\n1. view_file.yaml: Open a file from grid, verify viewer appears, verify dismiss works\n2. custom_recovery_phrase.yaml: Enter a custom phrase, verify save confirmation, verify phrase persists\n3. manage_shares.yaml: Verify share list shows share entries (use MAESTRO_SEED_SHARES flag?)\n4. join_vault.yaml: Add deeper assertion on phrase input screen elements\n5. camera_flip.yaml, flash_toggle.yaml, take_photo.yaml: Add non-optional assertions for UI state changes (button text/icon changes)\n\nFor flows limited by simulator/CloudKit, document the limitation explicitly in the YAML comments.\n\nKEY FILES: apps/ios/maestro/flows/ (all shallow flow files listed above)","status":"closed","priority":3,"issue_type":"task","owner":"r@turek.co","created_at":"2026-02-21T11:38:19.440308-08:00","created_by":"ehmo","updated_at":"2026-02-21T13:01:11.014863-08:00","closed_at":"2026-02-21T13:01:11.014863-08:00","close_reason":"Closed"}
{"id":"VAULT-fat","title":"Refactor: Extract VaultIndexManager from VaultStorage God Object","description":"VaultStorage.swift is 1640 lines with 7 nested types, owning blob I/O, index CRUD+migration, multi-blob pool, file store/retrieve/delete, vault destruction, and key management. First split: extract VaultIndexManager (index load/save/migrate/nested types VaultIndex, VaultFileEntry, BlobDescriptor, ShareRecord, SharePolicy). Medium effort, low risk. Prerequisite for @MainActor migration (A9).","status":"closed","priority":2,"issue_type":"task","owner":"r@turek.co","created_at":"2026-02-17T20:37:28.776565-08:00","created_by":"ehmo","updated_at":"2026-02-17T22:17:28.562364-08:00","closed_at":"2026-02-17T22:17:28.562364-08:00","close_reason":"Extracted in commit 3d66c85"}
{"id":"VAULT-fxo","title":"Add retry to markShareConsumed","description":"ARCHITECTURE #9: CloudKitSharingManager.markShareConsumed() calls publicDatabase.save(record) directly without saveWithRetry(). Transient network error leaves share unconsumed, breaking one-time-use guarantee.\n\nFIX: Replace publicDatabase.save(record) with saveWithRetry(record) at line ~942 of CloudKitSharingManager.swift.\n\n1-line fix. No risks.","status":"closed","priority":1,"issue_type":"bug","owner":"r@turek.co","created_at":"2026-02-21T11:36:21.93373-08:00","created_by":"ehmo","updated_at":"2026-02-21T11:45:22.928455-08:00","closed_at":"2026-02-21T11:45:22.928455-08:00","close_reason":"Replaced publicDatabase.save with saveWithRetry in markShareConsumed. Build passed."}
{"id":"VAULT-g0q","title":"Consolidate duplicate PBKDF2 into KeyDerivation","description":"CloudKitSharingManager.deriveShareKey() duplicates KeyDerivation.deriveShareKey() - same 800K iterations, same salt. Consolidate into single implementation in KeyDerivation.","status":"closed","priority":1,"issue_type":"task","owner":"r@turek.co","created_at":"2026-02-11T22:00:43.110046-08:00","created_by":"ehmo","updated_at":"2026-02-11T22:04:43.407462-08:00","closed_at":"2026-02-11T22:04:43.407462-08:00","close_reason":"Closed"}
{"id":"VAULT-gvf","title":"[Test-3] Create ShareImportManagerTests with mock infrastructure","description":"ZERO test coverage for ShareImportManager.swift - manages download + import of shared vaults from CloudKit.\n\nTESTS TO WRITE (new file: VaultTests/ShareImportManagerTests.swift):\n1. testImportLifecycleHappyPath - start import, complete, verify vault created\n2. testImportResumeAfterCrash - write pending import state, create new manager, verify resume\n3. testImportTTLExpiration - set old createdAt, verify cleanup\n4. testImportWithCorruptedSVDF - download succeeds but SVDF is invalid, verify error\n5. testImportWithWrongShareKey - decrypt fails, verify clear error message\n6. testImportClaimedPhrase - phrase already claimed, verify .alreadyClaimed\n7. testImportRevokedPhrase - phrase revoked, verify .revoked\n8. testConcurrentImportRequests - multiple imports, verify no race\n\nSETUP: Follow ShareSyncManagerTests.swift mock pattern. Use protocol-based CloudKit mock.\n\nFile: apps/ios/Vault/Core/Sharing/ShareImportManager.swift (source)\nNew: apps/ios/VaultTests/ShareImportManagerTests.swift","status":"open","priority":2,"issue_type":"task","owner":"r@turek.co","created_at":"2026-02-23T13:30:39.402239-08:00","created_by":"ehmo","updated_at":"2026-02-23T13:30:39.402239-08:00"}
{"id":"VAULT-gwd","title":"Refactor: Extract VaultImportCoordinator from VaultView+Actions","description":"VaultView+Actions.swift has ~600 lines of business logic (performPhotoImport lines 318-503, performFileImport 582-707): file I/O, encryption, thumbnail generation, progress tracking, error accumulation, subscription limits, UI state. Extract to VaultImportCoordinator. Combine with VaultViewModel extraction (VAULT-7up).","status":"closed","priority":3,"issue_type":"task","owner":"r@turek.co","created_at":"2026-02-17T20:38:13.403743-08:00","created_by":"ehmo","updated_at":"2026-02-17T22:56:59.986298-08:00","closed_at":"2026-02-17T22:56:59.986298-08:00","close_reason":"Absorbed into VAULT-7up: import logic now lives in VaultViewModel. Further extraction to standalone coordinator deferred as P3."}
{"id":"VAULT-h5q","title":"Make consumedStatusByShareVaultIds throw instead of returning empty on failure","description":"CODE QUALITY #14: CloudKitSharingManager.consumedStatusByShareVaultIds returns [:] on CloudKit query failure (line 926). This makes consumed shares appear active in UI.\n\nFIX:\n1. Change return type from [String: Bool] to throws\n2. Remove the catch { return [:] } block - let errors propagate\n3. Update callers to handle the error (show 'couldn't check status' in UI)\n\nKEY FILES:\n- apps/ios/Vault/Core/Sharing/CloudKitSharingManager.swift (line ~926)\n- Callers: ShareVaultView.swift, VaultView+SharedVault.swift (add error handling)","status":"closed","priority":2,"issue_type":"bug","owner":"r@turek.co","created_at":"2026-02-21T11:36:51.636537-08:00","created_by":"ehmo","updated_at":"2026-02-21T12:31:24.013358-08:00","closed_at":"2026-02-21T12:31:24.013358-08:00","close_reason":"Changed return type to throws, updated protocol, implementation, 2 callers, and 2 test mocks"}
{"id":"VAULT-i0q","title":"WS4: Milestone celebrations","status":"closed","priority":2,"issue_type":"feature","owner":"r@turek.co","created_at":"2026-02-08T23:11:01.168117-08:00","created_by":"ehmo","updated_at":"2026-02-08T23:11:38.281979-08:00","closed_at":"2026-02-08T23:11:38.281979-08:00","close_reason":"Closed"}
{"id":"VAULT-i5m","title":"Refactor: Clarify BackgroundShareTransferManager vs ShareUploadManager split","description":"Both BSTM (938 lines) and SUM (1183 lines) manage upload, pending state, background task registration. Architecture decision: BSTM = download/import only, SUM = upload only. Strip all upload logic from BSTM. Reduce duplication, eliminate ambiguity about which manager to use.","status":"closed","priority":2,"issue_type":"task","owner":"r@turek.co","created_at":"2026-02-17T20:37:40.037739-08:00","created_by":"ehmo","updated_at":"2026-02-17T22:31:00.75828-08:00","closed_at":"2026-02-17T22:31:00.75828-08:00","close_reason":"Deferred ‚Äî BSTM upload methods aren't called externally (only download/import used). Low risk as-is. Cleanup can be done in a future session."}
{"id":"VAULT-ihl","title":"Security: Share key uses fixed salt for all users ‚Äî per-phrase salt needed","description":"KeyDerivation.deriveKey(from:) uses literal 'vault-share-v1-salt' as PBKDF2 salt for all share keys. Standard practice: per-phrase salt. Fix: SHA256('vault-share-v1-' + normalized_phrase) as salt. Breaking change for all existing shares ‚Äî requires migration on first open after upgrade.","status":"closed","priority":1,"issue_type":"bug","owner":"r@turek.co","created_at":"2026-02-17T20:36:29.767098-08:00","created_by":"ehmo","updated_at":"2026-02-17T22:08:30.271306-08:00","closed_at":"2026-02-17T22:08:30.271306-08:00","close_reason":"Implemented and tested in commit 07af505"}
{"id":"VAULT-iky","title":"Pre-decode UIImage thumbnails off main thread","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-29T14:08:40.882358-08:00","created_by":"ehmo","updated_at":"2026-01-29T14:09:43.359351-08:00","closed_at":"2026-01-29T14:09:43.359351-08:00","close_reason":"Closed"}
{"id":"VAULT-im7","title":"Tests: Nonce chunk-swap test ‚Äî paired with streaming decrypt nonce enforcement fix","description":"Once VAULT-bad (XOR nonce verification in streaming decrypt) is fixed: add test that encrypts a 2-chunk file, swaps the chunks in the byte stream, and verifies decryption throws tamperedChunk. Blocked on VAULT-bad.","status":"closed","priority":1,"issue_type":"task","owner":"r@turek.co","created_at":"2026-02-17T20:38:41.063484-08:00","created_by":"ehmo","updated_at":"2026-02-17T21:12:52.593348-08:00","closed_at":"2026-02-17T21:12:52.593348-08:00","close_reason":"Closed","dependencies":[{"issue_id":"VAULT-im7","depends_on_id":"VAULT-bad","type":"blocks","created_at":"2026-02-17T20:38:44.655981-08:00","created_by":"ehmo"}]}
{"id":"VAULT-iym","title":"Replace custom header bars with NavigationStack toolbar","description":"ChangePatternView, RecoveryPhraseInputView, CustomRecoveryPhraseInputView build custom HStack headers instead of NavigationStack with .toolbar. Breaks iOS patterns, no blur/scroll behavior.","status":"closed","priority":2,"issue_type":"task","owner":"r@turek.co","created_at":"2026-02-01T15:10:22.218731-08:00","created_by":"ehmo","updated_at":"2026-02-01T15:20:45.51791-08:00","closed_at":"2026-02-01T15:20:45.51791-08:00","close_reason":"Replaced custom HStack header bars with NavigationStack + .toolbar in: RecoveryPhraseInputView, ChangePatternView, CustomRecoveryPhraseInputView, and RecoveryPhraseView. All now use standard .navigationTitle/.navigationBarTitleDisplayMode(.inline) with .cancellationAction or .confirmationAction toolbar items."}
{"id":"VAULT-kqn","title":"Eagerly init VaultStorage singleton at launch","status":"closed","priority":3,"issue_type":"task","created_at":"2026-01-29T14:08:41.173201-08:00","created_by":"ehmo","updated_at":"2026-01-29T14:10:38.13767-08:00","closed_at":"2026-01-29T14:10:38.13767-08:00","close_reason":"Closed"}
{"id":"VAULT-l71","title":"Ensure PBKDF2 runs off Main Actor","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-29T14:08:40.978949-08:00","created_by":"ehmo","updated_at":"2026-01-29T14:09:59.090786-08:00","closed_at":"2026-01-29T14:09:59.090786-08:00","close_reason":"Closed"}
{"id":"VAULT-lcw","title":"Implement brute-force protection with progressive delays","description":"ARCHITECTURE #4: SecureEnclaveManager has incrementWipeCounter()/getWipeCounter() but PatternLockView never calls them. Zero brute-force protection beyond PBKDF2 cost.\n\nIMPLEMENTATION:\n1. In PatternLockView.handlePatternComplete(), on failed unlock:\n   - Call SecureEnclaveManager.shared.incrementWipeCounter()\n   - Read counter value\n   - Apply progressive delay before allowing next attempt:\n     - 1-3 failures: no delay\n     - 4-5: 5 second delay\n     - 6-8: 30 second delay  \n     - 9-10: 5 minute delay\n     - 11+: 15 minute delay\n   - Show countdown UI during delay\n2. On successful unlock: call resetWipeCounter()\n3. Do NOT implement auto-wipe (too risky for accidental data loss from children/friends)\n4. Consider: make delay thresholds configurable in VaultSettings (advanced option)\n\nKEY FILES:\n- apps/ios/Vault/Features/PatternLock/PatternLockView.swift (add counter calls)\n- apps/ios/Vault/Core/Security/SecureEnclaveManager.swift (counter already exists)\n- apps/ios/Vault/UI/Components/ (new CountdownView for delay display)\n\nTESTS NEEDED:\n- Unit test: counter increment/reset\n- Unit test: delay calculation for each threshold\n- Maestro flow: failed pattern shows delay (use short delays in test mode)","status":"closed","priority":1,"issue_type":"feature","owner":"r@turek.co","created_at":"2026-02-21T11:35:51.370732-08:00","created_by":"ehmo","updated_at":"2026-02-21T12:04:12.224113-08:00","closed_at":"2026-02-21T12:04:12.224113-08:00","close_reason":"Implemented progressive delays (5s/30s/5m/15m) on failed pattern attempts using SecureEnclaveManager wipe counter. Lockout persists via UserDefaults with countdown UI."}
{"id":"VAULT-lts","title":"Add ShareViewController unit tests with mock NSItemProviders","description":"TEST #28: ShareExtensionIntegrationTests tests crypto pipeline in-process but not actual ShareViewController lifecycle. Extension has had jetsam/watchdog crashes in production.\n\nCreate ShareViewControllerTests.swift:\n- Test: single item provider processing\n- Test: multiple item providers (batch)\n- Test: progress callbacks fire correctly\n- Test: memory pressure handling (simulate didReceiveMemoryWarning)\n- Test: partial completion (2 of 5 files processed, extension terminated)\n- Test: manifest atomicity (partial writes don't corrupt manifest)\n- Test: error handling for invalid provider types\n- Test: large file handling (mock provider returning large data)\n\nUse mock NSItemProviders that return test data synchronously.\n\nKEY FILES:\n- apps/ios/Vault/Extensions/ShareExtension/ShareViewController.swift (489 lines)\n- apps/ios/VaultTests/ShareExtensionIntegrationTests.swift (existing crypto pipeline tests)","status":"closed","priority":2,"issue_type":"task","owner":"r@turek.co","created_at":"2026-02-21T11:38:05.685814-08:00","created_by":"ehmo","updated_at":"2026-02-21T12:47:49.667517-08:00","closed_at":"2026-02-21T12:47:49.667517-08:00","close_reason":"ShareViewController lives in ShareExtension target (not Vault). VaultTests can only test @testable Vault. Existing ShareExtensionIntegrationTests cover the crypto pipeline. Testing the VC lifecycle requires a separate test host ‚Äî deferring."}
{"id":"VAULT-lw8","title":"WS5: Toast notification system","status":"closed","priority":1,"issue_type":"feature","owner":"r@turek.co","created_at":"2026-02-08T23:07:36.915488-08:00","created_by":"ehmo","updated_at":"2026-02-08T23:10:53.120985-08:00","closed_at":"2026-02-08T23:10:53.120985-08:00","close_reason":"Closed"}
{"id":"VAULT-mia","title":"Fix: Wipe counter returns .hashValue instead of raw Int32","description":"SecureEnclaveManager.getWipeCounter() reads 4 bytes as Int32 then calls .hashValue, returning a hash instead of the counter value. The wipe counter is non-functional as an incrementing counter. Fix: remove .hashValue, return the raw Int32. Low effort.","status":"closed","priority":0,"issue_type":"bug","owner":"r@turek.co","created_at":"2026-02-17T20:36:18.098393-08:00","created_by":"ehmo","updated_at":"2026-02-17T20:45:17.438228-08:00","closed_at":"2026-02-17T20:45:17.438228-08:00","close_reason":"Closed"}
{"id":"VAULT-mjp","title":"Parallelize file re-encryption in share upload","description":"BackgroundShareTransferManager:87-112 processes files sequentially. Use withTaskGroup to parallelize file reads + re-encryption, then collect results in order. Keep progress reporting per-file.","status":"closed","priority":2,"issue_type":"task","owner":"r@turek.co","created_at":"2026-02-01T16:40:25.344386-08:00","created_by":"ehmo","updated_at":"2026-02-01T16:42:26.737414-08:00","closed_at":"2026-02-01T16:42:26.737414-08:00","close_reason":"Replaced sequential for-loop with withThrowingTaskGroup for concurrent file read+re-encrypt. Results collected and sorted by original index for deterministic output."}
{"id":"VAULT-mn7","title":"Audit and fix critical try? silent error paths","description":"SecureEnclaveManager.getBlobCursorXORKey falls back to zeros silently. VaultView.deleteFile uses try? losing errors. Audit all try? in security paths.","status":"closed","priority":1,"issue_type":"task","owner":"r@turek.co","created_at":"2026-02-11T22:00:47.965535-08:00","created_by":"ehmo","updated_at":"2026-02-11T22:47:31.975828-08:00","closed_at":"2026-02-11T22:47:31.975828-08:00","close_reason":"Closed"}
{"id":"VAULT-mvg","title":"[Test-1] Create CKRetryTests for CloudKit retry layer","description":"ZERO tests for CKDatabase+Retry.swift which ALL sharing depends on. This file implements saveWithRetry, deleteWithRetry, exponential backoff, and isCKRetryable classification.\n\nTESTS TO WRITE (new file: VaultTests/CKRetryTests.swift):\n1. testSaveSucceedsOnFirstAttempt - mock returns success immediately\n2. testSaveSucceedsOnSecondAttempt - mock fails once with retryable error, succeeds second time\n3. testSaveExhaustsAllRetries - mock always fails, verify all 3 retries attempted, final error propagated\n4. testNonRetryableErrorShortCircuits - mock fails with non-retryable error, verify no retry\n5. testDeleteWithRetryFollowsSamePattern - verify delete retry works like save retry\n6. testRespectsRetryAfterHeader - CKError with retryAfterSeconds, verify delay used\n\nSETUP: Need mock CKDatabase protocol. CloudKitSharingClient protocol exists (used by ShareSyncManager) - may be reusable.\n\nFile: apps/ios/Vault/Core/Sharing/CKDatabase+Retry.swift (source)\nNew: apps/ios/VaultTests/CKRetryTests.swift","status":"open","priority":1,"issue_type":"task","owner":"r@turek.co","created_at":"2026-02-23T13:30:26.069932-08:00","created_by":"ehmo","updated_at":"2026-02-23T13:30:26.069932-08:00"}
{"id":"VAULT-n32","title":"[Arch-8] Move network monitoring into CloudKitSharingManager as actor-isolated property","description":"DATA RACE: CloudKitSharingManager.swift:7-8 has module-level globals:\n  private let networkMonitor = NWPathMonitor()\n  private var currentNetworkType: String = 'unknown'\n\ncurrentNetworkType is written on DispatchQueue.global(qos: .background) (line 74) and read from any thread via isOnWiFi (line 84) and canProceedWithNetwork() (line 89).\n\nFIX (Option A): Convert CloudKitSharingManager to an actor OR move network state into the class with proper isolation:\n1. Move networkMonitor and currentNetworkType into CloudKitSharingManager as instance properties\n2. Use actor isolation or a lock for currentNetworkType access\n3. Update isOnWiFi and canProceedWithNetwork() to access via the instance\n\nFiles: CloudKitSharingManager.swift:7-8, 63-74, 82-93\nTest: TSan (Thread Sanitizer) should no longer flag this.","status":"open","priority":2,"issue_type":"bug","owner":"r@turek.co","created_at":"2026-02-23T12:03:47.358169-08:00","created_by":"ehmo","updated_at":"2026-02-23T12:03:47.358169-08:00"}
{"id":"VAULT-ngi","title":"Add accessibility labels to all interactive elements","description":"Zero accessibilityLabel/Hint/Value modifiers in entire codebase. Icon-only buttons read SF Symbol names. Pattern grid unusable with VoiceOver. Progress indicators convey nothing to screen readers.","status":"closed","priority":0,"issue_type":"bug","owner":"r@turek.co","created_at":"2026-02-01T15:10:08.419435-08:00","created_by":"ehmo","updated_at":"2026-02-01T15:12:37.070398-08:00","closed_at":"2026-02-01T15:12:37.070398-08:00","close_reason":"Added accessibility labels to: VaultView toolbar buttons (settings, lock), shared vault update button, add files button, photo grid items, file grid items, pattern lock view (decorative icon hidden, recovery/join hints), pattern grid (label, hint, value), onboarding progress indicators, camera controls (flash, capture, flip), full screen viewer actions button, change pattern progress indicator, recovery phrase reveal button, empty state decorative icon hidden, feature row combined elements"}
{"id":"VAULT-nh1","title":"Perf: Cache decrypted VaultIndex in memory ‚Äî eliminate decrypt per file view","description":"VaultStorage.retrieveFile() calls loadIndex() on every invocation: reads file from disk, AES-GCM decrypts, JSON-decodes all entries. Swiping 20 photos = 20 full index decrypt+decode cycles. Fix: cache decrypted VaultIndex keyed by key fingerprint; invalidate only on saveIndex(). Index is already loaded at unlock time. VaultStorage.swift:969-983.","status":"closed","priority":1,"issue_type":"task","owner":"r@turek.co","created_at":"2026-02-17T20:37:16.662143-08:00","created_by":"ehmo","updated_at":"2026-02-17T21:15:59.125363-08:00","closed_at":"2026-02-17T21:15:59.125363-08:00","close_reason":"Closed"}
{"id":"VAULT-nix","title":"[CQ-1] Remove all [DEBUG] prefixed log messages from production code","description":"SECURITY: 7 [DEBUG]-prefixed os.log messages ship in production, leaking cryptographic metadata.\n\nFiles and lines to clean:\n- VaultStorage.swift:567 - '[DEBUG] storeFileFromURL START - filename: ..., key hash: ...'\n- VaultStorage.swift:571 - '[DEBUG] Loading index...'\n- VaultStorage.swift:573 - '[DEBUG] Index loaded - files: ..., hasMasterKey: ..., version: ...'\n- VaultStorage.swift:575 - '[DEBUG] Getting master key...'\n- VaultStorage.swift:577 - '[DEBUG] Master key retrieved, length: ...'\n- VaultIndexManager.swift:193 - '[DEBUG] getMasterKey called - hasEncryptedMasterKey: ...'\n- VaultIndexManager.swift:196 - '[DEBUG] encryptedMasterKey is nil - throwing corruptedData error'\n- VaultIndexManager.swift:199 - '[DEBUG] Decrypting master key...'\n- VaultIndexManager.swift:201 - '[DEBUG] Master key decrypted successfully, length: ...'\n\nACTION: Delete all these lines entirely. The existing non-DEBUG Logger calls provide sufficient operational telemetry.\nTEST: Build and verify no [DEBUG] strings remain in production code. grep -r '\\[DEBUG\\]' apps/ios/Vault/ should return nothing.","status":"open","priority":1,"issue_type":"bug","owner":"r@turek.co","created_at":"2026-02-23T13:24:10.626191-08:00","created_by":"ehmo","updated_at":"2026-02-23T13:24:10.626191-08:00"}
{"id":"VAULT-nl3","title":"Offload PBKDF2 key derivation to background Task","description":"PERFORMANCE #31: KeyDerivation.deriveKey() runs 600K PBKDF2-SHA512 iterations. Called from @MainActor AppState.unlockWithPattern(). Blocks main thread for 0.5-1s (2-3s on older devices).\n\nIMPLEMENTATION:\n1. In AppState.unlockWithPattern(), wrap KeyDerivation.deriveKey() in Task.detached { }\n2. await the result back on MainActor\n3. The unlock flow already shows LoadingView('Unlocking...') so user sees a spinner\n4. Same treatment for share key derivation (800K iterations) in ShareUploadManager and JoinVaultView\n5. Do NOT make KeyDerivation itself async - keep it as a pure function, let callers decide threading\n\nKEY FILES:\n- apps/ios/Vault/App/VaultApp.swift (unlockWithPattern - line ~290)\n- apps/ios/Vault/Core/Sharing/ShareUploadManager.swift (share key derivation)\n- apps/ios/Vault/Features/Sharing/JoinVaultView.swift (share key derivation)","status":"closed","priority":2,"issue_type":"task","owner":"r@turek.co","created_at":"2026-02-21T11:38:29.458579-08:00","created_by":"ehmo","updated_at":"2026-02-21T12:41:22.842927-08:00","closed_at":"2026-02-21T12:41:22.842927-08:00","close_reason":"Already resolved: deriveKey is nonisolated async (runs on cooperative pool, not MainActor). deriveShareKey callers are already off MainActor. No changes needed."}
{"id":"VAULT-nmy","title":"[Test-5] Add duress failure resilience tests","description":"DuressHandler failure during duress trigger is untested. Partial wipe scenarios are the most security-critical edge case.\n\nTESTS TO WRITE (add to VaultTests/DuressHandlerTests.swift):\n1. testDuressTrigerWhenShareRevocationFails - mock CloudKit to throw on revokeShare, verify duress still completes, all non-duress indexes deleted\n2. testDuressTrigerWhenRecoveryPhraseCreationFails - mock RecoveryPhraseManager.saveRecoveryPhrase to throw, verify vault data still destroyed\n3. testDuressTrigerWhenLoadIndexFails - mock VaultStorage to throw on loadIndex for duress key, verify falls through to destroyAllNonDuressData(duressKey: nil)\n4. testPerformNuclearWipeSecure - call performNuclearWipe(secure: true), verify blob content is randomized (read blob before/after)\n5. testDuressOnSharedVault - duress vault is itself a shared vault, verify active shares handled\n6. testConcurrentDuressTriger - two concurrent triggers, verify no crash/data corruption\n7. testDuressTrigerWhenRecoveryDestroyThrows - destroyAllRecoveryData() throws but duress proceeds\n\nSETUP: Needs protocol-based mocking for VaultStorage, RecoveryPhraseManager, and CloudKitSharingManager. DuressHandler already uses VaultStorage.shared directly - may need Arch-2 (DI protocols) first.\n\nDEPENDS ON: VAULT-0w6 (Arch-2 DI protocols) for mock injection","status":"open","priority":1,"issue_type":"task","owner":"r@turek.co","created_at":"2026-02-23T13:31:05.651636-08:00","created_by":"ehmo","updated_at":"2026-02-23T13:31:05.651636-08:00","dependencies":[{"issue_id":"VAULT-nmy","depends_on_id":"VAULT-0w6","type":"blocks","created_at":"2026-02-23T13:31:56.046604-08:00","created_by":"ehmo"}]}
{"id":"VAULT-nnt","title":"Refactor: VaultStorage @MainActor annotation ‚Äî replace NSRecursiveLock","description":"VaultStorage explicitly opts out of Swift actor isolation, uses NSRecursiveLock. Multiple managers call loadIndex/saveIndex concurrently. Fix: annotate VaultStorage as @MainActor ‚Äî simplest safe path for iOS app where all storage writes are triggered by user actions. Prerequisite: complete VaultIndexManager extraction.","status":"closed","priority":2,"issue_type":"task","owner":"r@turek.co","created_at":"2026-02-17T20:37:28.908606-08:00","created_by":"ehmo","updated_at":"2026-02-17T22:18:36.157422-08:00","closed_at":"2026-02-17T22:18:36.157422-08:00","close_reason":"Deferred ‚Äî @MainActor migration requires making all 49 loadIndex/saveIndex call sites async plus 15 internal VaultStorage methods. NSRecursiveLock works correctly. VaultIndexManager extraction (VAULT-fat) was the real prerequisite.","dependencies":[{"issue_id":"VAULT-nnt","depends_on_id":"VAULT-fat","type":"blocks","created_at":"2026-02-17T20:38:44.958785-08:00","created_by":"ehmo"}]}
{"id":"VAULT-nvx","title":"Tests: VaultFullChainTests ‚Äî pattern ‚Üí key derivation ‚Üí store ‚Üí retrieve ‚Üí verify","description":"No test exercises the full chain: draw pattern ‚Üí PatternSerializer ‚Üí KeyDerivation (PBKDF2) ‚Üí VaultStorage.loadIndex ‚Üí storeFile ‚Üí retrieveFile ‚Üí verify original bytes. Write VaultFullChainTests: known pattern, deriveKey, store 3 files, retrieve and compare, change pattern, verify files still accessible. Medium effort.","status":"closed","priority":1,"issue_type":"task","owner":"r@turek.co","created_at":"2026-02-17T20:36:51.838654-08:00","created_by":"ehmo","updated_at":"2026-02-17T21:12:52.64505-08:00","closed_at":"2026-02-17T21:12:52.64505-08:00","close_reason":"Closed"}
{"id":"VAULT-ofa","title":"Add unit test target + initial test coverage for sharing/crypto","description":"No test files exist in the project. Add XCTest target and initial coverage for: SVDFSerializer (pure functions), ShareSyncCache (file-based, use temp dirs), CryptoEngine round-trips, SharedVaultData.decode (plist vs JSON auto-detect). These are the highest-value, lowest-friction test targets.","status":"closed","priority":3,"issue_type":"task","owner":"r@turek.co","created_at":"2026-02-10T00:58:42.843552-08:00","created_by":"ehmo","updated_at":"2026-02-10T01:27:28.970484-08:00","closed_at":"2026-02-10T01:27:28.970484-08:00","close_reason":"Implemented VaultTests target with 32 tests across 4 suites (CryptoEngine, SVDF, ShareSyncCache, SharedVaultData). All pass."}
{"id":"VAULT-per","title":"Perf: Replace encryptedThumbnails [UUID:Data] with NSCache ‚Äî unbounded memory growth","description":"ThumbnailCache.swift:7: encryptedThumbnails is a plain [UUID:Data] dictionary with no eviction policy. NSCache (the image cache) has memory limits; the encrypted source data does not. 500 files √ó 50KB thumbnails = ~25MB permanently pinned. Fix: replace with NSCache\u003cNSUUID, NSData\u003e with a ~8MB byte cost limit.","status":"closed","priority":2,"issue_type":"task","owner":"r@turek.co","created_at":"2026-02-17T20:37:51.416894-08:00","created_by":"ehmo","updated_at":"2026-02-17T21:23:42.104862-08:00","closed_at":"2026-02-17T21:23:42.104862-08:00","close_reason":"Closed"}
{"id":"VAULT-phb","title":"[Perf-9] Use pre-loaded index/masterKey in batchExport()","description":"batchExport() (VaultViewModel.swift:299-319) calls retrieveFile() per file, each re-loading index and re-deriving master key. Should use retrieveFileContent(entry:index:masterKey:) with pre-loaded values.\n\nFIX:\n1. Before the loop: load index once, derive master key once\n   let index = try VaultStorage.shared.loadIndex(with: key)\n   let masterKey = try VaultStorage.shared.indexManager.getMasterKey(from: index, vaultKey: key)\n2. In the loop: find entry, call retrieveFileContent(entry:index:masterKey:)\n   guard let entry = index.files.first(where: { $0.fileId == id \u0026\u0026 !$0.isDeleted }) else { continue }\n   let result = try VaultStorage.shared.retrieveFileContent(entry: entry, index: index, masterKey: masterKey)\n\nNOTE: If Perf-5 (master key caching) is done, the per-call overhead becomes negligible. This fix is still worthwhile for explicitness.\n\nFile: apps/ios/Vault/Features/VaultViewer/VaultViewModel.swift:299-319\nTEST: Verify batch export produces correct files.","status":"open","priority":3,"issue_type":"task","owner":"r@turek.co","created_at":"2026-02-23T13:38:40.983908-08:00","created_by":"ehmo","updated_at":"2026-02-23T13:38:40.983908-08:00"}
{"id":"VAULT-pzr","title":"Bug: TOCTOU race in ImportIngestor ‚Äî force-unwrap after nil check","description":"ImportIngestor.processBatch: file URL is nil-checked at line 118-124 then re-fetched with force-unwrap at line 136. Orphan cleanup running concurrently could delete the file between check and use. Fix: fetch URL once with guard let, hold the URL variable through the entire operation. ImportIngestor.swift:118-136.","status":"closed","priority":1,"issue_type":"bug","owner":"r@turek.co","created_at":"2026-02-17T20:37:03.379774-08:00","created_by":"ehmo","updated_at":"2026-02-17T20:53:35.95724-08:00","closed_at":"2026-02-17T20:53:35.95724-08:00","close_reason":"Closed"}
{"id":"VAULT-q98","title":"Eliminate duplicate loadIndex on vault appear","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-29T14:08:40.785016-08:00","created_by":"ehmo","updated_at":"2026-01-29T14:09:43.286013-08:00","closed_at":"2026-01-29T14:09:43.286013-08:00","close_reason":"Closed"}
{"id":"VAULT-qdr","title":"[CQ-3] Extract BackgroundTaskCoordinator from 3 managers","description":"DRY: ~60 lines of identical background task management duplicated across ShareUploadManager, ShareSyncManager, and iCloudBackupManager.\n\nEach implements:\n- beginBackgroundExecution() / endBackgroundExecution() (~20 lines)\n- registerBackgroundProcessingTask() (~15 lines)\n- scheduleBackgroundResumeTask(earliestIn:) (~10 lines)\n\nPLAN:\n1. Create BackgroundTaskCoordinator class in Core/ with:\n   - beginExecution(identifier: String) -\u003e UIBackgroundTaskIdentifier\n   - endExecution(_ taskId: UIBackgroundTaskIdentifier)\n   - register(identifier: String)\n   - schedule(identifier: String, earliestIn: TimeInterval)\n2. Each manager holds a BackgroundTaskCoordinator instance\n3. Replace duplicated methods with coordinator calls\n4. Add centralized telemetry for background execution events\n\nFiles: ShareUploadManager.swift, ShareSyncManager.swift, iCloudBackupManager.swift\nNew file: Core/BackgroundTaskCoordinator.swift\nTEST: Existing background task tests should pass. Add unit test for coordinator.","status":"open","priority":2,"issue_type":"task","owner":"r@turek.co","created_at":"2026-02-23T13:24:21.824523-08:00","created_by":"ehmo","updated_at":"2026-02-23T13:24:21.824523-08:00"}
{"id":"VAULT-qg7","title":"[CQ-4] Deduplicate allocateBlobSpace: first overload delegates to second","description":"DRY: VaultStorage.swift has two allocateBlobSpace methods (lines 327-365 and 369-415) with ~35 identical lines. Only difference: second accepts handleCache parameter.\n\nFIX: Have the first method create a temporary empty handleCache and delegate to the second:\n  private func allocateBlobSpace(size: Int, index: inout VaultIndex) throws -\u003e BlobWriteResult {\n      var tempCache: [String: FileHandle] = [:]\n      defer { tempCache.values.forEach { try? $0.close() } }\n      return try allocateBlobSpace(size: size, index: \u0026index, handleCache: \u0026tempCache)\n  }\n\nFile: VaultStorage.swift:327-415\nTEST: Existing store/delete tests should pass unchanged.","status":"open","priority":3,"issue_type":"task","owner":"r@turek.co","created_at":"2026-02-23T13:24:34.827041-08:00","created_by":"ehmo","updated_at":"2026-02-23T13:24:34.827041-08:00"}
{"id":"VAULT-qgz","title":"Add haptic feedback to pattern grid and key interactions","description":"Zero haptic feedback anywhere. Pattern grid needs UISelectionFeedbackGenerator on dot hit, UINotificationFeedbackGenerator on unlock success/failure. Also needed on destructive confirmations.","status":"closed","priority":0,"issue_type":"feature","owner":"r@turek.co","created_at":"2026-02-01T15:10:11.154445-08:00","created_by":"ehmo","updated_at":"2026-02-01T15:15:57.661586-08:00","closed_at":"2026-02-01T15:15:57.661586-08:00","close_reason":"Added haptic feedback: UISelectionFeedbackGenerator on each dot hit in PatternGridView, UINotificationFeedbackGenerator(.warning) on pattern too short, (.error) on unlock fail, (.success) on unlock success in PatternLockView, (.success) on valid pattern and match in PatternSetupView, (.error) on pattern mismatch in PatternSetupView."}
{"id":"VAULT-qwu","title":"[Perf-1] Batch selfDestruct() deletes ‚Äî use deleteFiles(ids:)","description":"N+1: selfDestruct() calls deleteFile() per file, each doing loadIndex+saveIndex. For 100 files = 100 index encryptions + 100 disk writes.\n\nFIX: Replace loop at VaultViewModel.swift:857-864 with:\n  let allIds = Set(index.files.filter { !$0.isDeleted }.map { $0.fileId })\n  try VaultStorage.shared.deleteFiles(ids: allIds, with: key)\n\nThe batch deleteFiles(ids:with:) API already exists at VaultStorage.swift:794.\n\nFile: apps/ios/Vault/Features/VaultViewer/VaultViewModel.swift:857-864\nTEST: Verify self-destruct works and all files are securely overwritten.","status":"open","priority":2,"issue_type":"task","owner":"r@turek.co","created_at":"2026-02-23T13:37:43.18854-08:00","created_by":"ehmo","updated_at":"2026-02-23T13:37:43.18854-08:00"}
{"id":"VAULT-rd8","title":"Perf: Group FileHandles by blob in storeFiles() batch","description":"VaultStorage.storeFiles() opens+closes a new FileHandle per file in the loop. 100 batch imports = 100 kernel open/close syscalls. deleteFiles() already groups by blob and reuses handles. Mirror that pattern in storeFiles().","status":"closed","priority":3,"issue_type":"task","owner":"r@turek.co","created_at":"2026-02-17T20:38:23.531621-08:00","created_by":"ehmo","updated_at":"2026-02-17T22:45:35.868944-08:00","closed_at":"2026-02-17T22:45:35.868944-08:00","close_reason":"Closed"}
{"id":"VAULT-rlu","title":"Extract VaultView child views via extensions","description":"VaultView.swift is 1746 lines with 15+ responsibilities. Extract ImportManager, BatchOperations, SharedVaultSync into separate files via extensions.","status":"closed","priority":2,"issue_type":"task","owner":"r@turek.co","created_at":"2026-02-11T22:00:40.646197-08:00","created_by":"ehmo","updated_at":"2026-02-11T22:47:31.97833-08:00","closed_at":"2026-02-11T22:47:31.97833-08:00","close_reason":"Closed"}
{"id":"VAULT-rr6","title":"Remove raw vault keys from recovery database","description":"ARCHITECTURE #5: RecoveryPhraseManager stores full 32-byte derived patternKey in Keychain. If Keychain compromised (jailbreak + passcode), attacker gets all vault keys instantly without PBKDF2.\n\nIMPLEMENTATION:\n1. Remove patternKey field from VaultRecoveryInfo struct\n2. On recovery: re-derive key from stored phrase via KeyDerivation.deriveRecoveryKey(from: phrase)\n3. Use the derived key to decrypt the vault index (same as normal unlock)\n4. Add migration: read existing recovery DB, re-save without raw keys\n5. The recovery flow will now take ~0.5-1s (PBKDF2 derivation) - show spinner\n6. Update RecoveryPhraseManager.recoverVault() to derive key instead of returning stored key\n\nKEY FILES:\n- apps/ios/Vault/Features/Onboarding/RecoveryPhraseManager.swift (line 29: patternKey field)\n- apps/ios/Vault/App/VaultApp.swift (unlockWithKey call site after recovery)\n\nMIGRATION:\n- Read existing RecoveryDatabase\n- For each VaultRecoveryInfo: keep phrase, pattern, gridSize, vaultKeyHash; remove patternKey\n- Re-encrypt and save\n\nTESTS NEEDED:\n- Unit test: recovery flow derives key correctly\n- Unit test: migration preserves phrase and removes raw key\n- Unit test: old format data can be migrated","status":"closed","priority":1,"issue_type":"task","owner":"r@turek.co","created_at":"2026-02-21T11:36:00.49328-08:00","created_by":"ehmo","updated_at":"2026-02-21T12:11:32.349666-08:00","closed_at":"2026-02-21T12:11:32.349666-08:00","close_reason":"Removed patternKey from VaultRecoveryInfo. Recovery now re-derives via PBKDF2."}
{"id":"VAULT-rtd","title":"Extract shared PatternValidationFeedbackView component","description":"validationFeedback() is copy-pasted across PatternSetupView, ChangePatternView, SharedVaultInviteView, JoinVaultView. Extract to shared component in UI/Components/.","status":"closed","priority":2,"issue_type":"task","owner":"r@turek.co","created_at":"2026-02-11T22:00:46.642353-08:00","created_by":"ehmo","updated_at":"2026-02-11T22:28:19.161189-08:00","closed_at":"2026-02-11T22:28:19.161189-08:00","close_reason":"Closed"}
{"id":"VAULT-s8x","title":"Tests: ShareUploadManagerTests ‚Äî job lifecycle, persistence, cancellation","description":"ShareUploadManager core flow is untested: job creation, status transitions (pending‚Üíuploading‚Üícomplete/failed), persistence across app restarts, resume-after-crash, cancellation. Write tests using mock CloudKitSharingClient. Prerequisite: protocol extraction (VAULT-esf).","status":"closed","priority":2,"issue_type":"task","owner":"r@turek.co","created_at":"2026-02-17T20:38:02.858278-08:00","created_by":"ehmo","updated_at":"2026-02-17T22:42:10.042025-08:00","closed_at":"2026-02-17T22:42:10.042025-08:00","close_reason":"Closed","dependencies":[{"issue_id":"VAULT-s8x","depends_on_id":"VAULT-esf","type":"blocks","created_at":"2026-02-17T20:38:44.751238-08:00","created_by":"ehmo"}]}
{"id":"VAULT-s9o","title":"Increase pattern grid node touch targets to 44pt","description":"PatternGridView.swift nodeRadius is 16pt (32pt diameter), below 44pt HIG minimum. Visual nodes hard to target on iPhone SE. Also PatternLockView bottom buttons (recovery phrase, join shared vault) are small text-only buttons with no explicit frame.","status":"closed","priority":1,"issue_type":"bug","owner":"r@turek.co","created_at":"2026-02-01T15:10:16.128013-08:00","created_by":"ehmo","updated_at":"2026-02-01T15:17:37.445604-08:00","closed_at":"2026-02-01T15:17:37.445604-08:00","close_reason":"Increased pattern grid hit area to max(nodeRadius*1.5, 22pt) ensuring 44pt minimum diameter. Added minHeight: 44 to 'Use recovery phrase' and 'Join shared vault' buttons on lock screen."}
{"id":"VAULT-sbd","title":"[CQ-5] Extract writeEncryptedManifest helper from SVDFSerializer","description":"DRY: SVDF manifest encrypt+append pattern repeated 5 times across buildFull, buildFullStreaming, buildFullStreamingFromPlaintext, buildIncremental, buildIncrementalStreaming.\n\nEach repeats ~8-10 lines: encode manifest JSON -\u003e encrypt with key -\u003e write length prefix -\u003e write encrypted data.\n\nPLAN:\n1. Create private static func writeEncryptedManifest(_ manifest: [FileManifestEntry], to data: inout Data, using key: Data) throws\n   - Or a FileHandle variant for streaming methods\n2. Replace the 5 inline implementations with calls to the helper\n3. May need two variants: one for Data accumulation, one for FileHandle writing\n\nFile: SVDFSerializer.swift\nTEST: Existing SVDF round-trip tests (SVDFSerializerTests.swift) should pass unchanged.","status":"open","priority":3,"issue_type":"task","owner":"r@turek.co","created_at":"2026-02-23T13:24:40.327289-08:00","created_by":"ehmo","updated_at":"2026-02-23T13:24:40.327289-08:00"}
{"id":"VAULT-sny","title":"Enable Swift Strict Concurrency checking (P3)","description":"ARCHITECTURE #7: 23 singletons with mixed isolation models (@MainActor, NSRecursiveLock, none). @MainActor await omissions have regressed 3+ times per scratch-pad.\n\nIMPLEMENTATION:\n1. Set SWIFT_STRICT_CONCURRENCY=complete in Vault target build settings\n2. Fix all resulting warnings/errors:\n   - Cross-actor calls missing await\n   - Non-sendable types crossing actor boundaries\n   - Mutable shared state without isolation\n3. Keep VaultStorage on NSRecursiveLock (blocking I/O would starve cooperative pool)\n4. Consider converting pure-logic managers to actors where appropriate\n\nThis is a large effort. Prioritize fixing warnings in security-critical code first (Crypto, Security, PatternLock).\n\nKEY FILES: All 23 singleton classes (see root AGENTS.md Session 1 analysis for full list)\nRISK: High - may surface real concurrency bugs. Run full test suite after each batch of fixes.","status":"closed","priority":3,"issue_type":"task","owner":"r@turek.co","created_at":"2026-02-21T11:36:07.683372-08:00","created_by":"ehmo","updated_at":"2026-02-21T12:46:18.186076-08:00","closed_at":"2026-02-21T12:46:18.186076-08:00","close_reason":"SWIFT_STRICT_CONCURRENCY=complete enabled in project. Zero warnings ‚Äî codebase already clean."}
{"id":"VAULT-spe","title":"Add InactivityLockManager unit tests","description":"TEST #22: InactivityLockManager controls auto-locking after 5 min inactivity. Security-critical. Zero test coverage.\n\nIMPLEMENTATION:\nCreate InactivityLockManagerTests.swift:\n- Test: lock triggers after timeout (inject mock time source)\n- Test: activity resets the timer\n- Test: video playback suppresses lock\n- Test: background transition behavior\n- Test: foreground transition resets timer\n- Test: multiple rapid activity events don't accumulate\n\nNeed to make the time source injectable (currently uses real timers). Add a TimeProvider protocol or inject a clock.\n\nKEY FILES:\n- apps/ios/Vault/Core/InactivityLockManager.swift","status":"closed","priority":1,"issue_type":"task","owner":"r@turek.co","created_at":"2026-02-21T11:37:26.582103-08:00","created_by":"ehmo","updated_at":"2026-02-21T12:19:42.536616-08:00","closed_at":"2026-02-21T12:19:42.536616-08:00","close_reason":"16 tests covering timeout, activity reset, video suppression, lifecycle, rapid interactions, configurable timeout."}
{"id":"VAULT-srs","title":"Perf: Route large file retrieval through retrieveFileToTempURL (2x memory peak fix)","description":"VaultStorage.retrieveFileContent() loads entire encrypted file into Data, then decrypted into Data ‚Äî 2x peak for 50MB video = 100MB. retrieveFileToTempURL() exists with streaming decryption. Audit call sites in FullScreenPhotoViewer and SecureImageViewer ‚Äî route video and large files through the streaming path. Images under threshold stay in-memory.","status":"closed","priority":2,"issue_type":"task","owner":"r@turek.co","created_at":"2026-02-17T20:38:02.592125-08:00","created_by":"ehmo","updated_at":"2026-02-17T21:23:42.122368-08:00","closed_at":"2026-02-17T21:23:42.122368-08:00","close_reason":"Closed"}
{"id":"VAULT-t4a","title":"[Arch-1] Fix duress share revocation: loadAllIndexes reads encrypted data without decrypting","description":"SECURITY-CRITICAL: VaultStorage.loadAllIndexes() at line 1021-1043 reads vault index files and attempts JSONDecoder().decode() directly. But all vault indexes are AES-256-GCM encrypted (see VaultIndexManager.performSaveIndex). This means every decode silently fails, returning an empty array. Called by DuressHandler.revokeAllActiveShares(), so duress mode NEVER revokes shared vaults.\n\nFIX (Option A): The duress vault index is the only one we can decrypt (we have its key). Use the duress vault's own activeShares to revoke. Non-duress indexes are being destroyed anyway.\n\nFiles: VaultStorage.swift:1021-1043, DuressHandler.swift:114-141\nTest: Verify revocation actually calls CloudKitSharingManager.revokeShare for each activeShare in the duress vault's index.","status":"open","priority":0,"issue_type":"bug","owner":"r@turek.co","created_at":"2026-02-23T12:02:44.140281-08:00","created_by":"ehmo","updated_at":"2026-02-23T12:02:44.140281-08:00"}
{"id":"VAULT-t5u","title":"WS3: Vault door unlock transition","status":"closed","priority":2,"issue_type":"feature","owner":"r@turek.co","created_at":"2026-02-08T23:11:01.282373-08:00","created_by":"ehmo","updated_at":"2026-02-08T23:12:47.391355-08:00","closed_at":"2026-02-08T23:12:47.391355-08:00","close_reason":"Closed"}
{"id":"VAULT-ui8","title":"Perf: computeVisibleFiles() runs on every SwiftUI body evaluation","description":"VaultView.swift:215: computeVisibleFiles() (filter+sort+dict build, O(n log n)) runs on every body evaluation including fan menu open, search keystrokes, and import progress updates. Fix: cache as @State var visibleFiles, recompute only with onChange on files/searchText/sortOrder/filter. Immediate UI smoothness improvement for large vaults.","status":"closed","priority":1,"issue_type":"bug","owner":"r@turek.co","created_at":"2026-02-17T20:37:16.52901-08:00","created_by":"ehmo","updated_at":"2026-02-17T21:06:28.996619-08:00","closed_at":"2026-02-17T21:06:28.996619-08:00","close_reason":"Closed"}
{"id":"VAULT-uxf","title":"[Test-9] Add storeFileFromURL error path tests","description":"storeFileFromURL is the primary production import path (imports use URLs, not pre-loaded Data). Error paths are untested.\n\nTESTS TO WRITE (add to VaultTests/VaultStorageIntegrationTests.swift):\n1. testStoreFileFromURLWithNonExistentFile - pass URL to missing file, verify clean error (not crash)\n2. testStoreFileFromURLWithZeroByteFile - pass URL to empty file, verify behavior (success with empty content or clear error)\n3. testStoreFileFromURLWithPermissionDenied - pass URL to unreadable file, verify error\n4. testStoreFileFromURLStreamingLargeFile - file \u003e1MB uses VCSE streaming, verify round-trip\n5. testStoreFileFromURLPreservesOriginalDate - pass originalDate, verify stored in index entry\n6. testStoreFileFromURLPreservesFileId - pass custom fileId, verify stored\n\nFile: apps/ios/Vault/Core/Storage/VaultStorage.swift:563-637 (source)\nFile: apps/ios/VaultTests/VaultStorageIntegrationTests.swift (add tests)","status":"open","priority":3,"issue_type":"task","owner":"r@turek.co","created_at":"2026-02-23T13:31:39.140393-08:00","created_by":"ehmo","updated_at":"2026-02-23T13:31:39.140393-08:00"}
{"id":"VAULT-v8o","title":"Add Dark Mode variant for VaultHighlight color","description":"VaultHighlight (#E45858 coral red) has no dark appearance variant. All other custom colors have dark variants. Used extensively for errors/warnings/destructive actions. May have poor contrast in Dark Mode.","status":"closed","priority":1,"issue_type":"bug","owner":"r@turek.co","created_at":"2026-02-01T15:10:12.581931-08:00","created_by":"ehmo","updated_at":"2026-02-01T15:16:23.36766-08:00","closed_at":"2026-02-01T15:16:23.36766-08:00","close_reason":"Added dark appearance variant for VaultHighlight: light=#E45858 (coral red), dark=#FF6F6F (brighter coral) for better contrast against dark backgrounds. Now consistent with all other custom colors having both variants."}
{"id":"VAULT-vmn","title":"Tests: DuressHandlerTests ‚Äî P0 security, zero coverage","description":"DuressHandler has zero unit tests. triggerDuress() destroys all vault indexes except duress vault ‚Äî a bug here is either a security failure (fails to destroy) or data loss (destroys duress vault). Write full suite: setAsDuressVault, isDuressKey, clearDuressVault, hasDuressVault, triggerDuress (verify non-duress indexes deleted, duress vault intact), destroyAllNonDuressData. Use real temp directories.","status":"closed","priority":0,"issue_type":"task","owner":"r@turek.co","created_at":"2026-02-17T20:36:42.254736-08:00","created_by":"ehmo","updated_at":"2026-02-17T20:49:42.693161-08:00","closed_at":"2026-02-17T20:49:42.693161-08:00","close_reason":"Closed"}
{"id":"VAULT-vun","title":"Refactor: DRY ‚Äî extract updateManifestRecord() in CloudKitSharingManager","description":"CloudKitSharingManager.swift:207-218, 262-275, 314-327: query manifest by shareVaultId ‚Üí iterate matchResults ‚Üí update version/updatedAt/chunkCount ‚Üí save. Copied 3 times across syncSharedVault(), syncSharedVaultIncremental(), syncSharedVaultIncrementalFromFile(). Extract updateManifestRecord(shareVaultId:chunkCount:version:) async throws private helper.","status":"closed","priority":2,"issue_type":"task","owner":"r@turek.co","created_at":"2026-02-17T20:37:40.303466-08:00","created_by":"ehmo","updated_at":"2026-02-17T21:21:32.115903-08:00","closed_at":"2026-02-17T21:21:32.115903-08:00","close_reason":"Closed"}
{"id":"VAULT-w2w","title":"Fix BGProcessingTask scheduling bug in VaultApp.swift","description":"ARCHITECTURE #2: VaultApp.swift line 56 has a copy-paste bug:\n\n```swift\nif ShareSyncManager.shared.hasPendingSyncs {\n    ShareUploadManager.shared.scheduleBackgroundResumeTask(earliestIn: 15)  // BUG: wrong manager!\n}\n```\n\nShould be ShareSyncManager.shared.scheduleBackgroundResumeTask(earliestIn: 15).\n\nThis means syncs to shared vault recipients NEVER resume in background. Recipients see stale vault data until the owner reopens the app.\n\nFILE: apps/ios/Vault/App/VaultApp.swift, line ~56 (in the .background scene phase handler)\nFIX: 1-line change - replace ShareUploadManager with ShareSyncManager","status":"closed","priority":0,"issue_type":"bug","owner":"r@turek.co","created_at":"2026-02-21T11:35:31.473751-08:00","created_by":"ehmo","updated_at":"2026-02-21T11:42:03.342287-08:00","closed_at":"2026-02-21T11:42:03.342287-08:00","close_reason":"Fixed line 56 in VaultApp.swift: ShareUploadManager -\u003e ShareSyncManager. Build succeeded, committed and pushed."}
{"id":"VAULT-whd","title":"Remove optional:true from non-pattern Maestro assertions","description":"Nearly every Maestro assertion uses optional:true making tests pass trivially. Remove from button/text/navigation assertions, keep only for PatternGridView interactions.","status":"closed","priority":2,"issue_type":"task","owner":"r@turek.co","created_at":"2026-02-11T22:01:04.154343-08:00","created_by":"ehmo","updated_at":"2026-02-11T22:28:19.162444-08:00","closed_at":"2026-02-11T22:28:19.162444-08:00","close_reason":"Closed"}
{"id":"VAULT-x68","title":"Replace debug prints with structured os.log","description":"~80+ #if DEBUG print() blocks with emoji. App already uses Logger in iCloudBackupManager. Extend pattern to rest of codebase. Some prints leak key hashes.","status":"closed","priority":3,"issue_type":"task","owner":"r@turek.co","created_at":"2026-02-11T22:00:50.606694-08:00","created_by":"ehmo","updated_at":"2026-02-11T22:47:31.979538-08:00","closed_at":"2026-02-11T22:47:31.979538-08:00","close_reason":"Closed"}
{"id":"VAULT-x8b","title":"[Perf-4] Memoize computeVisibleFiles() in VaultViewModel","description":"computeVisibleFiles() (VaultViewModel.swift:113-161) runs on every SwiftUI body evaluation. It filters, searches, sorts, and partitions the entire file array. Runs on every state change ‚Äî progress updates, selections, toasts.\n\nFIX:\n1. Add private cached properties in VaultViewModel:\n   - private var _visibleFilesCache: ComputedVisibleFiles?\n   - private var _visibleFilesCacheGeneration: UInt64 = 0\n2. Add a generation counter bumped when files, searchText, sortOrder, or fileFilter change\n3. computeVisibleFiles() checks generation, returns cache if fresh\n4. Alternatively: use a computed property with didSet on the inputs to invalidate\n\nRETURN TYPE to cache: the tuple/struct containing (mediaFiles, documentFiles, mediaIndexById)\n\nFile: apps/ios/Vault/Features/VaultViewer/VaultViewModel.swift:113-161\nAlso: apps/ios/Vault/Features/VaultViewer/VaultView.swift:352 (call site)\nTEST: Verify grid still updates correctly when files change, search text changes, sort changes, filter changes.","status":"open","priority":2,"issue_type":"task","owner":"r@turek.co","created_at":"2026-02-23T13:37:54.315899-08:00","created_by":"ehmo","updated_at":"2026-02-23T13:37:54.315899-08:00"}
{"id":"VAULT-xp7","title":"Perf: listFiles() N+1 thumbnail decryptions ‚Äî replace with listFilesLightweight() in VaultSettingsView","description":"VaultStorage.listFiles() decrypts all thumbnails in a tight loop ‚Äî 500 AES-GCM ops on settings screen load. listFilesLightweight() was added to avoid this. Replace the listFiles() call in VaultSettingsView with listFilesLightweight(). Deprecate the thumbnail-decrypting overload.","status":"closed","priority":3,"issue_type":"task","owner":"r@turek.co","created_at":"2026-02-17T20:38:23.776924-08:00","created_by":"ehmo","updated_at":"2026-02-17T22:42:10.033111-08:00","closed_at":"2026-02-17T22:42:10.033111-08:00","close_reason":"Closed"}
{"id":"VAULT-xqp","title":"Perf: Debounce redundant loadVault/loadFiles calls in VaultView","description":"VaultView.swift has 3 non-debounced triggers that each call loadVault()/loadFiles() (full index decrypt). Settings dismiss + import complete within 1s triggers two concurrent loads. Fix: debounce with 0.1s, cancel prior in-flight Task.","status":"closed","priority":3,"issue_type":"task","owner":"r@turek.co","created_at":"2026-02-17T20:38:34.84003-08:00","created_by":"ehmo","updated_at":"2026-02-17T22:42:10.034745-08:00","closed_at":"2026-02-17T22:42:10.034745-08:00","close_reason":"Closed"}
{"id":"VAULT-yaf","title":"Add CameraManager unit tests","description":"TEST #26: CameraManager is @Observable with mutable state (flash mode, camera position, error). 3 Maestro camera flows use optional:true on every assertion (simulator limitation). No actual behavior is tested.\n\nCreate CameraManagerTests.swift:\n- Test: initial state (default camera position, flash mode)\n- Test: flip camera toggles front/back\n- Test: flash mode cycling (auto -\u003e on -\u003e off -\u003e auto)\n- Test: error state set on session failure\n- Test: photo capture callback receives image data\n- Test: session stop cleans up resources\n\nMock AVCaptureSession for testability. CameraManager is @Observable so state changes are verifiable.\n\nKEY FILES:\n- apps/ios/Vault/Features/Camera/CameraManager.swift","status":"closed","priority":2,"issue_type":"task","owner":"r@turek.co","created_at":"2026-02-21T11:37:50.894186-08:00","created_by":"ehmo","updated_at":"2026-02-21T12:47:33.416489-08:00","closed_at":"2026-02-21T12:47:33.416489-08:00","close_reason":"CameraManager tightly coupled to AVFoundation hardware (AVCaptureSession, AVCaptureDevice). All state changes in sessionQueue blocks that depend on real camera. Unit testing requires extracting CameraClient protocol first ‚Äî deferring to dedicated refactoring pass."}
{"id":"VAULT-yd5","title":"Copy-and-mutate VaultIndex in changeVaultKey","description":"changeVaultKey manually copies all VaultIndex fields (fragile). Replace with var newIndex = index; newIndex.encryptedMasterKey = newEncryptedMasterKey.","status":"closed","priority":1,"issue_type":"task","owner":"r@turek.co","created_at":"2026-02-11T22:00:52.425093-08:00","created_by":"ehmo","updated_at":"2026-02-11T22:04:43.404751-08:00","closed_at":"2026-02-11T22:04:43.404751-08:00","close_reason":"Closed"}
{"id":"VAULT-yw0","title":"Write-ahead pattern for changeVaultKey","description":"VaultStorage.changeVaultKey saves new index then deletes old. Crash between = data loss. Save new, verify reads back, then delete old.","status":"closed","priority":1,"issue_type":"task","owner":"r@turek.co","created_at":"2026-02-11T22:00:45.186778-08:00","created_by":"ehmo","updated_at":"2026-02-11T22:22:12.408417-08:00","closed_at":"2026-02-11T22:22:12.408417-08:00","close_reason":"Implemented write-ahead pattern: temp file -\u003e verify -\u003e atomic move -\u003e delete old. Stale .tmp files cleaned on init."}
{"id":"VAULT-zed","title":"Wrap VaultKey internals in SecureBytes for memory protection","description":"ARCHITECTURE #8: VaultKey wraps Data (copy-on-write value type). Key lives in AppState.currentVaultKey for entire session. When lockVault() sets it to nil, bytes are NOT zeroed. SecureBytes exists with auto-zeroing but isn't used for VaultKey.\n\nIMPLEMENTATION:\n1. Change VaultKey internal storage from Data to SecureBytes\n2. Audit all sites that extract .rawBytes - ensure they don't retain copies\n3. Verify SecureBytes.deinit zeroing works correctly for VaultKey lifecycle\n4. Same treatment for MasterKey and ShareKey wrappers in KeyTypes.swift\n5. Verify lockVault() path: setting currentVaultKey = nil should trigger SecureBytes.deinit -\u003e zeroise\n\nKEY FILES:\n- apps/ios/Vault/Core/Crypto/KeyTypes.swift (VaultKey, MasterKey, ShareKey structs)\n- apps/ios/Vault/Core/Crypto/SecureBytes.swift (existing auto-zeroing implementation)\n- apps/ios/Vault/App/VaultApp.swift (AppState.currentVaultKey lifecycle)\n\nDEPENDS ON: Issue VAULT-rr6 (remove raw keys from recovery DB) for full security value.\n\nTESTS NEEDED:\n- Unit test: VaultKey deallocation zeros underlying bytes\n- Unit test: VaultKey copy behavior with SecureBytes","status":"closed","priority":2,"issue_type":"task","owner":"r@turek.co","created_at":"2026-02-21T11:36:18.390384-08:00","created_by":"ehmo","updated_at":"2026-02-21T12:24:07.819528-08:00","closed_at":"2026-02-21T12:24:07.819528-08:00","close_reason":"VaultKey/MasterKey/ShareKey now use SecureBytes internally. Auto-zeroes on deallocation. Zero API changes.","dependencies":[{"issue_id":"VAULT-zed","depends_on_id":"VAULT-rr6","type":"blocks","created_at":"2026-02-21T11:38:44.395821-08:00","created_by":"ehmo"}]}
{"id":"VAULT-zgs","title":"Set large title display mode on root VaultView","description":"VaultView uses .navigationTitle(appState.vaultName) but doesn't specify .navigationBarTitleDisplayMode(.large). HIG requires large titles on primary/root views.","status":"closed","priority":1,"issue_type":"task","owner":"r@turek.co","created_at":"2026-02-01T15:10:17.70364-08:00","created_by":"ehmo","updated_at":"2026-02-01T15:18:05.834054-08:00","closed_at":"2026-02-01T15:18:05.834054-08:00","close_reason":"Added .navigationBarTitleDisplayMode(.large) to VaultView. Root view now shows large title per HIG Rule 2.3, transitioning to inline on scroll."}
{"id":"VAULT-zhw","title":"Stream-encrypt iCloud backup using CryptoEngine.encryptStreaming","description":"CRITICAL: performBackup loads entire 500MB blob into memory causing OOM crash. Use existing encryptStreaming API to process in 256KB chunks via FileHandle.","status":"closed","priority":0,"issue_type":"task","owner":"r@turek.co","created_at":"2026-02-11T22:01:07.685103-08:00","created_by":"ehmo","updated_at":"2026-02-11T22:47:31.974297-08:00","closed_at":"2026-02-11T22:47:31.974297-08:00","close_reason":"Closed"}
